<small>Claude Sonnet 4 **(Sportovní Analytika a Sledování Výkonnosti s RAG)**</small>
# Sports Analytics and Performance Tracker

## 1. Název Projektu

**Sports Analytics and Performance Tracker** - Inteligentní systém pro komplexní analýzu sportovní výkonnosti využívající RAG (Retrieval-Augmented Generation) pro sledování statistik hráčů, analýzu herního materiálu, optimalizaci tréninkových režimů a prevenci zranění.

## 2. Klíčové Koncepty

### RAG (Retrieval-Augmented Generation)
Pokročilá AI architektura kombinující vyhledávání relevantních sportovních dat s generativními schopnostmi pro vytváření personalizovaných analýz a doporučení.

### Statistiky Hráčů (Player Statistics)
Kvantitativní měřítka výkonnosti zahrnující skóre, asistence, přesnost střelby, rychlost, vzdálenost, srdeční frekvenci a další biometrické údaje.

### Herní Záznamy (Game Footage)
Video materiál ze zápasů a tréninků analyzovaný pomocí computer vision pro extrakci pohybových vzorců a taktických informací.

### Tréninkové Režimy (Training Regimens)
Strukturované tréninkové plány přizpůsobené individuálním potřebám hráčů na základě analýzy výkonnostních dat.

### Prevence Zranění (Injury Prevention)
Prediktivní modely identifikující rizikové faktory a navrhující preventivní opatření na základě biomechanických dat.

### ESPN API
Rozhraní pro přístup k oficiálním sportovním statistikám, výsledkům zápasů a historickým datům.

### Biomechanická Analýza
Vědecké studium pohybu těla během sportovních aktivit pro optimalizaci techniky a prevenci zranění.

### Týmová Strategie (Team Strategy)
Taktické plánování založené na analýze dat o výkonnosti týmu, soupeřích a herních situacích.

## 3. Komplexní Vysvětlení Projektu

### Cíle Projektu
Systém vytváří komplexní platformu pro sportovní analýzu zaměřenou na:

- **Výkonnostní optimalizace**: Identifikace silných a slabých stránek jednotlivých hráčů
- **Prediktivní analýza**: Předpovědi výkonnosti a rizik zranění
- **Personalizované tréninkové plány**: AI-generované doporučení pro zlepšení
- **Taktická analýza**: Strategické poznatky pro trenéry a analytiky
- **Real-time monitoring**: Okamžité sledování výkonnosti během tréninků a zápasů

### Technické Výzvy
- **Multimodální data**: Integrace video, audio, senzorových a textových dat
- **Real-time processing**: Zpracování dat v reálném čase během zápasů
- **Přesnost analýzy**: Vysoká přesnost při rozpoznávání pohybů a vzorců
- **Škálovatelnost**: Podpora více sportů a tisíců hráčů současně
- **Privacy a bezpečnost**: Ochrana citlivých zdravotních a výkonnostních dat

### Potenciální Dopad
- **Profesionální sport**: Konkurenční výhoda pro týmy a jednotlivce
- **Zdraví atletů**: Snížení rizika zranění a rychlejší rehabilitace
- **Tréninkové metody**: Revoluce v přípravě a rozvoji talentů
- **Fanouškovský zážitek**: Obohacení sledování sportu o pokročilé analýzy
- **Mládežnický sport**: Demokratizace přístupu k profesionálním analytickým nástrojům

## 4. Komplexní Příklad s Python Implementací

````python
import os
import json
import numpy as np
import pandas as pd
import cv2
import requests
from datetime import datetime, timedelta
from typing import List, Dict, Any, Optional, Tuple
import logging
from dataclasses import dataclass, asdict
import asyncio
import sqlite3

# AI/ML knihovny
from langchain.embeddings import OpenAIEmbeddings
from langchain.vectorstores import Chroma
from langchain.text_splitter import RecursiveCharacterTextSplitter
from langchain.llms import OpenAI
from langchain.chains import RetrievalQA
from langchain.schema import Document
from langchain.prompts import PromptTemplate

# Computer Vision a ML
import mediapipe as mp
from sklearn.ensemble import RandomForestClassifier, IsolationForest
from sklearn.preprocessing import StandardScaler
from sklearn.model_selection import train_test_split

# Vizualizace a analýza
import matplotlib.pyplot as plt
import seaborn as sns
import plotly.graph_objects as go
import plotly.express as px
from plotly.subplots import make_subplots

# Konfigurace logování
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

@dataclass
class PlayerProfile:
    """Profil hráče"""
    player_id: str
    name: str
    position: str
    age: int
    height: float  # cm
    weight: float  # kg
    team: str
    sport: str
    preferred_foot: str = "right"
    experience_years: int = 0

@dataclass
class GameStatistics:
    """Statistiky ze zápasu"""
    game_id: str
    player_id: str
    date: str
    minutes_played: int
    goals: int = 0
    assists: int = 0
    shots: int = 0
    shots_on_target: int = 0
    passes: int = 0
    pass_accuracy: float = 0.0
    distance_covered: float = 0.0  # km
    max_speed: float = 0.0  # km/h
    avg_heart_rate: int = 0
    max_heart_rate: int = 0
    tackles: int = 0
    fouls: int = 0

@dataclass
class BiomechanicalData:
    """Biomechanická data"""
    timestamp: str
    player_id: str
    joint_angles: Dict[str, float]
    force_distribution: Dict[str, float]
    acceleration: Dict[str, float]
    activity_type: str
    injury_risk_score: float = 0.0

@dataclass
class TrainingSession:
    """Tréninková jednotka"""
    session_id: str
    player_id: str
    date: str
    duration: int  # minutes
    training_type: str
    intensity: str  # low, medium, high
    exercises: List[str]
    performance_metrics: Dict[str, float]
    coach_notes: str = ""

class SportDataManager:
    """Správce sportovních dat"""
    
    def __init__(self, db_path: str = "sports_analytics.db"):
        self.db_path = db_path
        self.mp_pose = mp.solutions.pose.Pose()
        self.mp_drawing = mp.solutions.drawing_utils
        self._initialize_database()
        
    def _initialize_database(self):
        """Inicializace SQLite databáze"""
        try:
            conn = sqlite3.connect(self.db_path)
            cursor = conn.cursor()
            
            # Tabulka hráčů
            cursor.execute('''
                CREATE TABLE IF NOT EXISTS players (
                    player_id TEXT PRIMARY KEY,
                    name TEXT NOT NULL,
                    position TEXT,
                    age INTEGER,
                    height REAL,
                    weight REAL,
                    team TEXT,
                    sport TEXT,
                    preferred_foot TEXT,
                    experience_years INTEGER
                )
            ''')
            
            # Tabulka statistik
            cursor.execute('''
                CREATE TABLE IF NOT EXISTS game_stats (
                    game_id TEXT,
                    player_id TEXT,
                    date TEXT,
                    minutes_played INTEGER,
                    goals INTEGER,
                    assists INTEGER,
                    shots INTEGER,
                    shots_on_target INTEGER,
                    passes INTEGER,
                    pass_accuracy REAL,
                    distance_covered REAL,
                    max_speed REAL,
                    avg_heart_rate INTEGER,
                    max_heart_rate INTEGER,
                    tackles INTEGER,
                    fouls INTEGER,
                    PRIMARY KEY (game_id, player_id)
                )
            ''')
            
            conn.commit()
            conn.close()
            logger.info("Databáze úspěšně inicializována")
            
        except Exception as e:
            logger.error(f"Chyba při inicializaci databáze: {e}")
    
    def save_player_profile(self, player: PlayerProfile):
        """Uložení profilu hráče"""
        try:
            conn = sqlite3.connect(self.db_path)
            cursor = conn.cursor()
            
            cursor.execute('''
                INSERT OR REPLACE INTO players VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
            ''', (
                player.player_id, player.name, player.position, player.age,
                player.height, player.weight, player.team, player.sport,
                player.preferred_foot, player.experience_years
            ))
            
            conn.commit()
            conn.close()
            
        except Exception as e:
            logger.error(f"Chyba při ukládání hráče: {e}")
    
    def save_game_statistics(self, stats: GameStatistics):
        """Uložení herních statistik"""
        try:
            conn = sqlite3.connect(self.db_path)
            cursor = conn.cursor()
            
            cursor.execute('''
                INSERT OR REPLACE INTO game_stats VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
            ''', (
                stats.game_id, stats.player_id, stats.date, stats.minutes_played,
                stats.goals, stats.assists, stats.shots, stats.shots_on_target,
                stats.passes, stats.pass_accuracy, stats.distance_covered,
                stats.max_speed, stats.avg_heart_rate, stats.max_heart_rate,
                stats.tackles, stats.fouls
            ))
            
            conn.commit()
            conn.close()
            
        except Exception as e:
            logger.error(f"Chyba při ukládání statistik: {e}")
    
    def get_player_statistics(self, player_id: str, days: int = 30) -> List[GameStatistics]:
        """Získání statistik hráče za posledních N dní"""
        try:
            conn = sqlite3.connect(self.db_path)
            
            end_date = datetime.now()
            start_date = end_date - timedelta(days=days)
            
            query = '''
                SELECT * FROM game_stats 
                WHERE player_id = ? AND date >= ? 
                ORDER BY date DESC
            '''
            
            df = pd.read_sql_query(query, conn, params=(player_id, start_date.isoformat()))
            conn.close()
            
            stats_list = []
            for _, row in df.iterrows():
                stats = GameStatistics(
                    game_id=row['game_id'],
                    player_id=row['player_id'],
                    date=row['date'],
                    minutes_played=row['minutes_played'],
                    goals=row['goals'],
                    assists=row['assists'],
                    shots=row['shots'],
                    shots_on_target=row['shots_on_target'],
                    passes=row['passes'],
                    pass_accuracy=row['pass_accuracy'],
                    distance_covered=row['distance_covered'],
                    max_speed=row['max_speed'],
                    avg_heart_rate=row['avg_heart_rate'],
                    max_heart_rate=row['max_heart_rate'],
                    tackles=row['tackles'],
                    fouls=row['fouls']
                )
                stats_list.append(stats)
            
            return stats_list
            
        except Exception as e:
            logger.error(f"Chyba při načítání statistik: {e}")
            return []
    
    def create_sample_data(self):
        """Vytvoření ukázkových dat"""
        try:
            # Ukázkoví hráči
            players = [
                PlayerProfile("P001", "Jan Novák", "Forward", 25, 180, 75, "FC Praha", "Football"),
                PlayerProfile("P002", "Petr Svoboda", "Midfielder", 23, 175, 70, "FC Praha", "Football"),
                PlayerProfile("P003", "Tomáš Dvořák", "Defender", 28, 185, 80, "FC Praha", "Football"),
                PlayerProfile("P004", "Martin Černý", "Goalkeeper", 30, 190, 85, "FC Praha", "Football")
            ]
            
            for player in players:
                self.save_player_profile(player)
            
            # Ukázkové statistiky
            for i, player in enumerate(players):
                for day in range(10):  # Posledních 10 zápasů
                    date = (datetime.now() - timedelta(days=day*7)).isoformat()
                    stats = GameStatistics(
                        game_id=f"G{day+1:03d}",
                        player_id=player.player_id,
                        date=date,
                        minutes_played=90 - np.random.randint(0, 20),
                        goals=np.random.poisson(0.3 if player.position != "Forward" else 0.8),
                        assists=np.random.poisson(0.2),
                        shots=np.random.poisson(2 if player.position == "Forward" else 1),
                        shots_on_target=np.random.randint(0, 4),
                        passes=np.random.randint(30, 80),
                        pass_accuracy=np.random.uniform(0.75, 0.95),
                        distance_covered=np.random.uniform(8.0, 12.0),
                        max_speed=np.random.uniform(25.0, 35.0),
                        avg_heart_rate=np.random.randint(140, 170),
                        max_heart_rate=np.random.randint(180, 200),
                        tackles=np.random.poisson(3 if player.position == "Defender" else 1),
                        fouls=np.random.poisson(1)
                    )
                    self.save_game_statistics(stats)
            
            logger.info("Ukázková data úspěšně vytvořena")
            
        except Exception as e:
            logger.error(f"Chyba při vytváření ukázkových dat: {e}")

class BiomechanicalAnalyzer:
    """Analyzátor biomechanických dat"""
    
    def __init__(self):
        self.pose = mp.solutions.pose.Pose(
            static_image_mode=False,
            model_complexity=2,
            enable_segmentation=True,
            min_detection_confidence=0.5
        )
        self.injury_risk_model = None
        self._train_injury_risk_model()
    
    def _train_injury_risk_model(self):
        """Trénování modelu pro predikci rizika zranění"""
        try:
            # Syntetická data pro trénování
            n_samples = 1000
            
            # Features: úhly kloubů, síly, akcelerace
            features = np.random.rand(n_samples, 15)  # 15 biomechanických features
            
            # Simulace labelů (riziko zranění)
            # Vysoké hodnoty některých features = vyšší riziko
            risk_scores = (
                features[:, 0] * 0.3 +  # úhel kolena
                features[:, 1] * 0.25 + # síla na kotník
                features[:, 2] * 0.2 +  # laterální akcelerace
                np.random.normal(0, 0.1, n_samples)
            )
            
            labels = (risk_scores > np.percentile(risk_scores, 80)).astype(int)
            
            # Trénování modelu
            self.scaler = StandardScaler()
            features_scaled = self.scaler.fit_transform(features)
            
            self.injury_risk_model = RandomForestClassifier(n_estimators=100, random_state=42)
            self.injury_risk_model.fit(features_scaled, labels)
            
            logger.info("Model pro predikci rizika zranění natrénován")
            
        except Exception as e:
            logger.error(f"Chyba při trénování modelu: {e}")
    
    def analyze_movement_video(self, video_path: str) -> List[BiomechanicalData]:
        """Analýza pohybu z videa"""
        try:
            cap = cv2.VideoCapture(video_path)
            biomech_data = []
            frame_count = 0
            
            while cap.isOpened():
                ret, frame = cap.read()
                if not ret:
                    break
                
                # Konverze do RGB
                rgb_frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
                
                # Detekce pózy
                results = self.pose.process(rgb_frame)
                
                if results.pose_landmarks:
                    # Extrakce úhlů kloubů
                    joint_angles = self._extract_joint_angles(results.pose_landmarks)
                    
                    # Simulace dalších biomechanických dat
                    force_dist = {
                        'left_foot': np.random.uniform(0.3, 0.7),
                        'right_foot': np.random.uniform(0.3, 0.7)
                    }
                    
                    acceleration = {
                        'x': np.random.uniform(-5, 5),
                        'y': np.random.uniform(-5, 5),
                        'z': np.random.uniform(-2, 2)
                    }
                    
                    # Predikce rizika zranění
                    features = list(joint_angles.values()) + list(force_dist.values()) + list(acceleration.values())
                    if len(features) >= 15:
                        features_scaled = self.scaler.transform([features[:15]])
                        injury_risk = self.injury_risk_model.predict_proba(features_scaled)[0][1]
                    else:
                        injury_risk = 0.0
                    
                    biomech_data.append(BiomechanicalData(
                        timestamp=datetime.now().isoformat(),
                        player_id="P001",  # Výchozí hráč
                        joint_angles=joint_angles,
                        force_distribution=force_dist,
                        acceleration=acceleration,
                        activity_type="running",
                        injury_risk_score=injury_risk
                    ))
                
                frame_count += 1
                if frame_count > 100:  # Limit pro demo
                    break
            
            cap.release()
            return biomech_data
            
        except Exception as e:
            logger.error(f"Chyba při analýze videa: {e}")
            return []
    
    def _extract_joint_angles(self, landmarks) -> Dict[str, float]:
        """Extrakce úhlů kloubů z landmark dat"""
        try:
            # Simulace výpočtu úhlů kloubů
            angles = {}
            
            # Základní úhly (simulované)
            angles['knee_left'] = np.random.uniform(10, 170)
            angles['knee_right'] = np.random.uniform(10, 170)
            angles['ankle_left'] = np.random.uniform(70, 110)
            angles['ankle_right'] = np.random.uniform(70, 110)
            angles['hip_left'] = np.random.uniform(10, 180)
            angles['hip_right'] = np.random.uniform(10, 180)
            angles['shoulder_left'] = np.random.uniform(0, 180)
            angles['shoulder_right'] = np.random.uniform(0, 180)
            angles['elbow_left'] = np.random.uniform(0, 180)
            angles['elbow_right'] = np.random.uniform(0, 180)
            
            return angles
            
        except Exception as e:
            logger.error(f"Chyba při extrakci úhlů: {e}")
            return {}

class PerformanceKnowledgeBase:
    """Znalostní báze pro sportovní výkonnost"""
    
    def __init__(self):
        self.documents = []
        self.vector_store = None
        self.embeddings = OpenAIEmbeddings(openai_api_key=os.getenv('OPENAI_API_KEY'))
        self._initialize_knowledge_base()
    
    def _initialize_knowledge_base(self):
        """Inicializace znalostní báze se sportovními poznatky"""
        try:
            # Vytvoření sportovních dokumentů
            sports_documents = [
                {
                    'title': 'Fotbalová Výkonnost a Statistiky',
                    'content': """
                    Klíčové ukazatele výkonnosti ve fotbale:
                    
                    Útočníci:
                    - Góly na zápas: Světová špička 0.5-1.0 gólu/zápas
                    - Střelecká přesnost: 35-50% střel na branku
                    - Přihrávky v posledním pásmu: 15-25 za zápas
                    - Rychlost: Šprinty nad 25 km/h, celkem 2-4 km za zápas
                    
                    Záložníci:
                    - Přesnost přihrávek: 85-95%
                    - Asistence: 0.2-0.4 za zápas
                    - Běžecká výkonnost: 10-12 km za zápas
                    - Souboje: 60-70% úspěšnost
                    
                    Obránci:
                    - Úspěšnost skluzů: 70-80%
                    - Vzdušné souboje: 65-75% úspěšnost
                    - Přesnost dlouhých přihrávek: 60-75%
                    - Intercepty: 5-8 za zápas
                    
                    Brankáři:
                    - Úspěšnost zákroků: 65-80%
                    - Rozehrávka: 75-85% přesnost
                    - Vysoké míče: 90%+ úspěšnost
                    """
                },
                {
                    'title': 'Prevence Zranění ve Sportu',
                    'content': """
                    Rizikové faktory zranění:
                    
                    Biomechanické:
                    - Nesprávná technika běhu/skoku
                    - Asymetrie v síle nebo flexibility
                    - Nevyvážená zátěž na klouby
                    - Únavové vzorce pohybu
                    
                    Fyziologické:
                    - Vysoká srdeční frekvence v klidu
                    - Snížená variabilita srdeční frekvence
                    - Vysoké hladiny kortizolu
                    - Nedostatečné zotavení
                    
                    Tréninkové:
                    - Náhlé zvýšení intenzity
                    - Nedostatečné rozehřátí
                    - Monotónní zatížení
                    - Přetrénování
                    
                    Preventivní opatření:
                    - Individualizované rozcvičky
                    - Silové tréninky na stabilitu
                    - Monitoring únavy
                    - Postupná progrese zatížení
                    """
                },
                {
                    'title': 'Optimalizace Tréninkových Plánů',
                    'content': """
                    Periodizace tréninku:
                    
                    Mikrocyklus (týden):
                    - 2-3 vysokointenzivní jednotky
                    - 2-3 střední intenzity
                    - 1-2 regenerační dny
                    - Poměr zatížení/odpočinek 3:1
                    
                    Mezocyklus (měsíc):
                    - Postupné zvyšování zatížení
                    - Každý 4. týden regenerační
                    - Specifická příprava na soutěž
                    - Monitoring únavy a adaptace
                    
                    Makrocyklus (sezóna):
                    - Přípravné období: objem před intenzitou
                    - Soutěžní období: udržení formy
                    - Přechodné období: aktivní odpočinek
                    
                    Individualizace:
                    - Věk a zkušenosti
                    - Pozice a herní styl
                    - Historie zranění
                    - Genetické predispozice
                    - Psychologický profil
                    """
                },
                {
                    'title': 'Týmová Strategie a Taktika',
                    'content': """
                    Analýza herních situací:
                    
                    Útočná fáze:
                    - Držení míče vs. přímočarost
                    - Postavení v pokutovém území
                    - Standardní situace
                    - Přechod do útoku
                    
                    Obranná fáze:
                    - Pressing vs. blok
                    - Kompaktnost formace
                    - Pokrývání prostoru
                    - Přechod do obrany
                    
                    Klíčové metriky:
                    - xG (expected goals): 1.5-2.5 pro vítězství
                    - Držení míče: 45-65% optimum
                    - Přesnost přihrávek: min. 80%
                    - PPDA (passes per defensive action): 8-15
                    
                    Adaptace na soupeře:
                    - Analýza slabých míst
                    - Individuální pokrývání hráčů
                    - Využití standardních situací
                    - Tempo hry a intenzita
                    """
                }
            ]
            
            # Vytvoření Document objektů
            for doc_data in sports_documents:
                doc = Document(
                    page_content=doc_data['content'],
                    metadata={'title': doc_data['title'], 'source': 'sports_knowledge'}
                )
                self.documents.append(doc)
            
            # Rozdělení dokumentů
            text_splitter = RecursiveCharacterTextSplitter(
                chunk_size=600,
                chunk_overlap=50
            )
            
            split_docs = text_splitter.split_documents(self.documents)
            
            # Vytvoření vector store
            self.vector_store = Chroma.from_documents(
                split_docs,
                self.embeddings,
                persist_directory="./sports_chroma_db"
            )
            
            logger.info(f"Sportovní znalostní báze inicializována s {len(split_docs)} fragmenty")
            
        except Exception as e:
            logger.error(f"Chyba při inicializaci znalostní báze: {e}")

class SportsAnalyticsRAG:
    """RAG systém pro sportovní analýzy"""
    
    def __init__(self):
        self.knowledge_base = PerformanceKnowledgeBase()
        self.llm = OpenAI(
            temperature=0.2,
            openai_api_key=os.getenv('OPENAI_API_KEY')
        )
        self.qa_chain = self._setup_qa_chain()
        
        # Specializované prompty
        self.performance_prompt = PromptTemplate(
            input_variables=["player_stats", "context"],
            template="""
            Jako sportovní analytik analyzuj následující statistiky hráče a poskytni detailní hodnocení:
            
            Statistiky hráče: {player_stats}
            
            Kontext z databáze znalostí: {context}
            
            Poskytni:
            1. Hodnocení současné výkonnosti
            2. Identifikaci silných a slabých stránek
            3. Srovnání s benchmarky
            4. Konkrétní doporučení pro zlepšení
            5. Rizikové faktory a prevenci
            
            Odpověď formátuj jasně a strukturovaně.
            """
        )
    
    def _setup_qa_chain(self):
        """Nastavení QA řetězce"""
        try:
            if self.knowledge_base.vector_store:
                retriever = self.knowledge_base.vector_store.as_retriever(
                    search_kwargs={"k": 4}
                )
                
                qa_chain = RetrievalQA.from_chain_type(
                    llm=self.llm,
                    chain_type="stuff",
                    retriever=retriever,
                    return_source_documents=True
                )
                
                return qa_chain
            return None
            
        except Exception as e:
            logger.error(f"Chyba při nastavení QA řetězce: {e}")
            return None
    
    def analyze_player_performance(self, player_id: str, 
                                 game_stats: List[GameStatistics]) -> Dict[str, Any]:
        """Analýza výkonnosti hráče"""
        try:
            if not game_stats:
                return {'error': 'Žádné statistiky k analýze'}
            
            # Výpočet agregovaných statistik
            total_games = len(game_stats)
            avg_stats = {
                'goals_per_game': sum(s.goals for s in game_stats) / total_games,
                'assists_per_game': sum(s.assists for s in game_stats) / total_games,
                'pass_accuracy': sum(s.pass_accuracy for s in game_stats) / total_games,
                'avg_distance': sum(s.distance_covered for s in game_stats) / total_games,
                'avg_max_speed': sum(s.max_speed for s in game_stats) / total_games,
                'avg_heart_rate': sum(s.avg_heart_rate for s in game_stats) / total_games
            }
            
            # Trend analýza
            recent_games = game_stats[:5]  # Posledních 5 zápasů
            if len(recent_games) >= 3:
                recent_avg_goals = sum(s.goals for s in recent_games) / len(recent_games)
                form_trend = "stoupající" if recent_avg_goals > avg_stats['goals_per_game'] else "klesající"
            else:
                form_trend = "nedostatek dat"
            
            # Příprava dat pro AI analýzu
            stats_summary = f"""
            Hráč ID: {player_id}
            Analyzovaných zápasů: {total_games}
            
            Průměrné statistiky:
            - Góly na zápas: {avg_stats['goals_per_game']:.2f}
            - Asistence na zápas: {avg_stats['assists_per_game']:.2f}
            - Přesnost přihrávek: {avg_stats['pass_accuracy']:.1%}
            - Průběhnutá vzdálenost: {avg_stats['avg_distance']:.1f} km
            - Maximální rychlost: {avg_stats['avg_max_speed']:.1f} km/h
            - Průměrná srdeční frekvence: {avg_stats['avg_heart_rate']:.0f} bpm
            
            Forma: {form_trend}
            """
            
            # AI analýza
            if self.qa_chain:
                query = f"Analyzuj výkonnost hráče na základě těchto statistik: {stats_summary}"
                result = self.qa_chain({"query": query})
                
                ai_analysis = result['result']
                source_docs = [doc.page_content[:200] + "..." for doc in result['source_documents']]
            else:
                ai_analysis = "AI analýza není dostupná"
                source_docs = []
            
            return {
                'player_id': player_id,
                'analysis_period': f"{game_stats[-1].date} - {game_stats[0].date}",
                'aggregate_stats': avg_stats,
                'form_trend': form_trend,
                'ai_analysis': ai_analysis,
                'source_knowledge': source_docs,
                'detailed_recommendations': self._generate_recommendations(avg_stats),
                'analysis_timestamp': datetime.now().isoformat()
            }
            
        except Exception as e:
            logger.error(f"Chyba při analýze výkonnosti: {e}")
            return {'error': str(e)}
    
    def _generate_recommendations(self, stats: Dict[str, float]) -> List[str]:
        """Generování konkrétních doporučení"""
        recommendations = []
        
        if stats['goals_per_game'] < 0.3:
            recommendations.append("Zaměřit se na dokončování akcí a střeleckou přípravu")
        
        if stats['pass_accuracy'] < 0.8:
            recommendations.append("Zlepšit techniku přihrávek a rozhodování pod tlakem")
        
        if stats['avg_distance'] < 9.0:
            recommendations.append("Zvýšit běžeckou aktivitu a zapojení do hry")
        
        if stats['avg_max_speed'] < 28.0:
            recommendations.append("Pracovat na explozivní rychlosti a sprintech")
        
        if not recommendations:
            recommendations.append("Udržet současnou úroveň výkonnosti a pracovat na konzistenci")
        
        return recommendations
    
    def predict_injury_risk(self, biomech_data: List[BiomechanicalData]) -> Dict[str, Any]:
        """Predikce rizika zranění"""
        try:
            if not biomech_data:
                return {'error': 'Žádná biomechanická data'}
            
            # Analýza trendů v riziku zranění
            risk_scores = [data.injury_risk_score for data in biomech_data]
            avg_risk = np.mean(risk_scores)
            max_risk = np.max(risk_scores)
            trend = np.polyfit(range(len(risk_scores)), risk_scores, 1)[0]
            
            # Kategorizace rizika
            if avg_risk < 0.3:
                risk_level = "Nízké"
                color = "green"
            elif avg_risk < 0.6:
                risk_level = "Střední"
                color = "yellow"
            else:
                risk_level = "Vysoké"
                color = "red"
            
            # AI doporučení pro prevenci
            query = f"""
            Analyzuj riziko zranění s těmito parametry:
            - Průměrné riziko: {avg_risk:.3f}
            - Maximální riziko: {max_risk:.3f}
            - Trend: {'rostoucí' if trend > 0 else 'klesající'}
            - Úroveň rizika: {risk_level}
            
            Poskytni preventivní doporučení.
            """
            
            if self.qa_chain:
                result = self.qa_chain({"query": query})
                prevention_advice = result['result']
            else:
                prevention_advice = "AI poradenství není dostupné"
            
            return {
                'risk_assessment': {
                    'average_risk': avg_risk,
                    'maximum_risk': max_risk,
                    'risk_level': risk_level,
                    'trend': 'rostoucí' if trend > 0 else 'klesající',
                    'color_indicator': color
                },
                'prevention_recommendations': prevention_advice,
                'data_points_analyzed': len(biomech_data),
                'assessment_timestamp': datetime.now().isoformat()
            }
            
        except Exception as e:
            logger.error(f"Chyba při predikci rizika zranění: {e}")
            return {'error': str(e)}

class SportsVisualizer:
    """Vizualizace sportovních dat"""
    
    def __init__(self):
        plt.style.use('seaborn-v0_8')
        
    def create_performance_dashboard(self, player_analysis: Dict[str, Any]) -> go.Figure:
        """Vytvoření dashboardu výkonnosti"""
        try:
            stats = player_analysis['aggregate_stats']
            
            fig = make_subplots(
                rows=2, cols=3,
                subplot_titles=(
                    'Gólová Produktivita', 'Fyzická Výkonnost', 'Srdeční Frekvence',
                    'Přesnost Přihrávek', 'Trend Formy', 'Celkové Hodnocení'
                ),
                specs=[
                    [{"type": "bar"}, {"type": "scatter"}, {"type": "indicator"}],
                    [{"type": "pie"}, {"type": "scatter"}, {"type": "indicator"}]
                ]
            )
            
            # 1. Gólová produktivita
            fig.add_trace(
                go.Bar(
                    x=['Góly', 'Asistence'],
                    y=[stats['goals_per_game'], stats['assists_per_game']],
                    marker_color=['#FF6B6B', '#4ECDC4'],
                    name='Produktivita'
                ),
                row=1, col=1
            )
            
            # 2. Fyzická výkonnost
            fig.add_trace(
                go.Scatter(
                    x=[stats['avg_distance']],
                    y=[stats['avg_max_speed']],
                    mode='markers',
                    marker=dict(size=20, color='#45B7D1'),
                    name='Fyzická výkonnost'
                ),
                row=1, col=2
            )
            
            # 3. Srdeční frekvence - gauge
            fig.add_trace(
                go.Indicator(
                    mode="gauge+number",
                    value=stats['avg_heart_rate'],
                    title={'text': "Avg HR (bpm)"},
                    gauge={'axis': {'range': [120, 200]},
                           'bar': {'color': "red"},
                           'steps': [{'range': [120, 150], 'color': "lightgray"},
                                    {'range': [150, 180], 'color': "gray"}]}
                ),
                row=1, col=3
            )
            
            # 4. Přesnost přihrávek
            pass_acc = stats['pass_accuracy']
            fig.add_trace(
                go.Pie(
                    labels=['Úspěšné', 'Neúspěšné'],
                    values=[pass_acc, 1-pass_acc],
                    marker_colors=['#2ECC71', '#E74C3C']
                ),
                row=2, col=1
            )
            
            # 5. Simulovaný trend formy
            games = list(range(1, 11))
            form_trend = np.random.normal(stats['goals_per_game'], 0.2, 10)
            fig.add_trace(
                go.Scatter(
                    x=games,
                    y=form_trend,
                    mode='lines+markers',
                    line=dict(color='#9B59B6'),
                    name='Forma'
                ),
                row=2, col=2
            )
            
            # 6. Celkové hodnocení
            overall_score = (
                stats['goals_per_game'] * 30 +
                stats['assists_per_game'] * 20 +
                stats['pass_accuracy'] * 40 +
                (stats['avg_distance'] / 12) * 10
            )
            
            fig.add_trace(
                go.Indicator(
                    mode="gauge+number",
                    value=overall_score,
                    title={'text': "Celkové Hodnocení"},
                    gauge={'axis': {'range': [0, 100]},
                           'bar': {'color': "gold"},
                           'steps': [{'range': [0, 50], 'color': "lightgray"},
                                    {'range': [50, 75], 'color': "gray"},
                                    {'range': [75, 100], 'color': "lightgreen"}]}
                ),
                row=2, col=3
            )
            
            fig.update_layout(
                height=800,
                title_text=f"Dashboard Výkonnosti - Hráč {player_analysis.get('player_id', 'N/A')}",
                showlegend=False
            )
            
            return fig
            
        except Exception as e:
            logger.error(f"Chyba při vytváření dashboardu: {e}")
            return go.Figure()
    
    def create_injury_risk_chart(self, risk_data: Dict[str, Any]) -> go.Figure:
        """Graf rizika zranění"""
        try:
            risk_assessment = risk_data['risk_assessment']
            
            # Simulace historických dat
            days = pd.date_range(start='2024-01-01', periods=30, freq='D')
            risk_history = np.random.beta(2, 5, 30) * 0.8 + 0.1
            
            fig = go.Figure()
            
            # Historický trend
            fig.add_trace(
                go.Scatter(
                    x=days,
                    y=risk_history,
                    mode='lines+markers',
                    name='Historické riziko',
                    line=dict(color='blue', width=2)
                )
            )
            
            # Současné riziko
            fig.add_hline(
                y=risk_assessment['average_risk'],
                line_dash="dash",
                line_color=risk_assessment['color_indicator'],
                annotation_text=f"Současné riziko: {risk_assessment['risk_level']}"
            )
            
            # Prahové hodnoty
            fig.add_hrect(
                y0=0, y1=0.3,
                fillcolor="green", opacity=0.1,
                annotation_text="Nízké riziko", annotation_position="top left"
            )
            
            fig.add_hrect(
                y0=0.3, y1=0.6,
                fillcolor="yellow", opacity=0.1,
                annotation_text="Střední riziko", annotation_position="top left"
            )
            
            fig.add_hrect(
                y0=0.6, y1=1.0,
                fillcolor="red", opacity=0.1,
                annotation_text="Vysoké riziko", annotation_position="top left"
            )
            
            fig.update_layout(
                title="Analýza Rizika Zranění",
                xaxis_title="Datum",
                yaxis_title="Skóre Rizika (0-1)",
                yaxis=dict(range=[0, 1]),
                template='plotly_white'
            )
            
            return fig
            
        except Exception as e:
            logger.error(f"Chyba při vytváření grafu rizika: {e}")
            return go.Figure()

class SportsAnalyticsSystem:
    """Hlavní systém sportovní analýzy"""
    
    def __init__(self):
        self.data_manager = SportDataManager()
        self.biomech_analyzer = BiomechanicalAnalyzer()
        self.rag_system = SportsAnalyticsRAG()
        self.visualizer = SportsVisualizer()
        
        # Inicializace ukázkových dat
        self.data_manager.create_sample_data()
    
    def comprehensive_player_analysis(self, player_id: str) -> Dict[str, Any]:
        """Komplexní analýza hráče"""
        try:
            # Získání statistik
            game_stats = self.data_manager.get_player_statistics(player_id, days=60)
            
            if not game_stats:
                return {'error': f'Žádné statistiky pro hráče {player_id}'}
            
            # Analýza výkonnosti
            performance_analysis = self.rag_system.analyze_player_performance(player_id, game_stats)
            
            # Simulace biomechanických dat (v reálné aplikaci by byla z videa/senzorů)
            biomech_data = self._generate_sample_biomech_data(player_id)
            
            # Analýza rizika zranění
            injury_risk = self.rag_system.predict_injury_risk(biomech_data)
            
            # Vytvoření vizualizací
            performance_dashboard = self.visualizer.create_performance_dashboard(performance_analysis)
            injury_chart = self.visualizer.create_injury_risk_chart(injury_risk)
            
            return {
                'player_id': player_id,
                'performance_analysis': performance_analysis,
                'injury_risk_assessment': injury_risk,
                'visualizations': {
                    'performance_dashboard': performance_dashboard.to_json(),
                    'injury_risk_chart': injury_chart.to_json()
                },
                'recommendations': self._compile_recommendations(performance_analysis, injury_risk),
                'analysis_timestamp': datetime.now().isoformat()
            }
            
        except Exception as e:
            logger.error(f"Chyba při komplexní analýze: {e}")
            return {'error': str(e)}
    
    def _generate_sample_biomech_data(self, player_id: str) -> List[BiomechanicalData]:
        """Generování ukázkových biomechanických dat"""
        biomech_data = []
        
        for i in range(20):  # 20 měření
            timestamp = (datetime.now() - timedelta(hours=i)).isoformat()
            
            data = BiomechanicalData(
                timestamp=timestamp,
                player_id=player_id,
                joint_angles={
                    'knee_left': np.random.uniform(10, 170),
                    'knee_right': np.random.uniform(10, 170),
                    'ankle_left': np.random.uniform(70, 110),
                    'ankle_right': np.random.uniform(70, 110)
                },
                force_distribution={
                    'left_foot': np.random.uniform(0.3, 0.7),
                    'right_foot': np.random.uniform(0.3, 0.7)
                },
                acceleration={
                    'x': np.random.uniform(-5, 5),
                    'y': np.random.uniform(-5, 5),
                    'z': np.random.uniform(-2, 2)
                },
                activity_type='training',
                injury_risk_score=np.random.beta(2, 8)  # Převážně nízké riziko
            )
            
            biomech_data.append(data)
        
        return biomech_data
    
    def _compile_recommendations(self, performance: Dict[str, Any], 
                               injury_risk: Dict[str, Any]) -> Dict[str, List[str]]:
        """Kompilace všech doporučení"""
        recommendations = {
            'performance_improvements': performance.get('detailed_recommendations', []),
            'injury_prevention': [],
            'training_focus': [],
            'immediate_actions': []
        }
        
        # Doporučení pro prevenci zranění
        risk_level = injury_risk.get('risk_assessment', {}).get('risk_level', 'Neznámé')
        
        if risk_level == 'Vysoké':
            recommendations['immediate_actions'].extend([
                'Konzultace s fyziotherapeutem',
                'Snížení tréninkové intenzity',
                'Důraz na regeneraci'
            ])
        elif risk_level == 'Střední':
            recommendations['injury_prevention'].extend([
                'Monitoring biomechaniky',
                'Preventivní cvičení',
                'Pravidelné kontroly'
            ])
        
        # Tréninkové doporučení
        avg_stats = performance.get('aggregate_stats', {})
        if avg_stats.get('goals_per_game', 0) < 0.5:
            recommendations['training_focus'].append('Střelecká příprava')
        
        if avg_stats.get('pass_accuracy', 1) < 0.85:
            recommendations['training_focus'].append('Technická práce s míčem')
        
        return recommendations

# Demonstrační použití
def main():
    """Demonstrace funkcionality systému"""
    try:
        print("🏆 Inicializace Systému Sportovní Analýzy...")
        system = SportsAnalyticsSystem()
        
        # Test analýzy hráče
        player_id = "P001"
        print(f"\n📊 Spouštím komplexní analýzu hráče {player_id}...")
        
        analysis = system.comprehensive_player_analysis(player_id)
        
        if 'error' not in analysis:
            print("\n✅ VÝSLEDKY ANALÝZY:")
            print("=" * 60)
            
            # Výkonnostní analýza
            performance = analysis['performance_analysis']
            if 'aggregate_stats' in performance:
                stats = performance['aggregate_stats']
                print(f"🎯 VÝKONNOSTNÍ STATISTIKY:")
                print(f"   • Góly na zápas: {stats['goals_per_game']:.2f}")
                print(f"   • Asistence na zápas: {stats['assists_per_game']:.2f}")
                print(f"   • Přesnost přihrávek: {stats['pass_accuracy']:.1%}")
                print(f"   • Průměrná rychlost: {stats['avg_max_speed']:.1f} km/h")
                print(f"   • Forma: {performance.get('form_trend', 'N/A')}")
            
            # Riziko zranění
            injury_risk = analysis['injury_risk_assessment']
            if 'risk_assessment' in injury_risk:
                risk = injury_risk['risk_assessment']
                print(f"\n⚕️ ANALÝZA RIZIKA ZRANĚNÍ:")
                print(f"   • Úroveň rizika: {risk['risk_level']}")
                print(f"   • Průměrné skóre: {risk['average_risk']:.3f}")
                print(f"   • Trend: {risk['trend']}")
            
            # Doporučení
            recommendations = analysis['recommendations']
            print(f"\n💡 KLÍČOVÁ DOPORUČENÍ:")
            for category, items in recommendations.items():
                if items:
                    print(f"   {category.replace('_', ' ').title()}:")
                    for item in items[:2]:  # Zobraz max 2 položky
                        print(f"   • {item}")
            
            print(f"\n🕐 Analýza dokončena: {analysis['analysis_timestamp']}")
            
        else:
            print(f"❌ Chyba při analýze: {analysis['error']}")
            
    except Exception as e:
        logger.error(f"Chyba v main funkci: {e}")

if __name__ == "__main__":
    # Nastavení environment variables
    # os.environ['OPENAI_API_KEY'] = 'your-openai-api-key-here'
    
    main()
````

### Požadované závislosti

````toml
# Core AI/ML libraries
langchain==0.0.350
openai==1.3.0
chromadb==0.4.18

# Computer Vision
opencv-python==4.8.1.78
mediapipe==0.10.8

# Machine Learning
scikit-learn==1.3.2
numpy==1.24.4
pandas==2.1.3

# Visualization
matplotlib==3.8.2
seaborn==0.13.0
plotly==5.17.0

# Database and utilities
sqlite3
requests==2.31.0
python-dotenv==1.0.0

# Optional: Advanced features
tensorflow==2.15.0
streamlit==1.28.2
````

### Instalační skript

````bash
#!/bin/bash

echo "🏆 Nastavení prostředí pro Sportovní Analýzu..."

# Vytvoření virtuálního prostředí
python -m venv sports_env
source sports_env/bin/activate  # Windows: sports_env\Scripts\activate

# Instalace závislostí
pip install -r requirements.txt

# Vytvoření adresářů
mkdir -p data/videos
mkdir -p data/biomechanics
mkdir -p results/analysis
mkdir -p sports_chroma_db

echo "✅ Prostředí úspěšně nastaveno!"
echo "📝 Nezapomeňte nastavit OPENAI_API_KEY v .env souboru"
echo "🎥 Umístěte tréninkové videa do data/videos/"
````

## 5. Shrnutí Projektu

### Klíčová Hodnota Projektu
Systém sportovní analýzy s RAG technologií přináší revoluci v oblasti:

- **Personalizované analýzy**: AI-driven poznatky přizpůsobené jednotlivým hráčům
- **Prediktivní zdravotnictví**: Prevence zranění založená na biomechanických datech
- **Optimalizace výkonnosti**: Data-driven doporučení pro zlepšení herního výkonu
- **Strategické plánování**: Inteligentní podpora rozhodování trenérů a analytiků
- **Demokratizace pokročilých analýz**: Přístup k profesionálním nástrojům pro všechny úrovně

### Technologické Inovace
- **Multimodální RAG**: Kombinace textových, video a senzorových dat
- **Real-time processing**: Okamžité zpracování během live událostí
- **Biomechanická AI**: Pokročilé rozpoznávání pohybových vzorců
- **Prediktivní modelování**: Machine learning pro prevenci zranění
- **Integrovaná platforma**: Spojení všech aspektů sportovní analýzy

### Obchodní Přínosy
- **Konkurenční výhoda**: Lepší výkonnost týmů a jednotlivců
- **Snížení nákladů**: Prevence zranění a optimalizace tréninků
- **Rozšíření trhu**: Nové služby pro sportovní organizace
- **Vědecký pokrok**: Pokročilé poznatky o lidské výkonnosti
- **Fan engagement**: Obohacení zážitku pro fanoušky

Tento projekt představuje budoucnost sportovní analýzy, kde AI a pokročilé technologie umožňují dosažení nových výšin lidské výkonnosti při zachování zdraví a bezpečnosti atletů.