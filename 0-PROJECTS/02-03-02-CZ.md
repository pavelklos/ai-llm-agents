<small>Claude Sonnet 4 **(Smart Contract Auditor Squad - Multi-Agent Syst√©m pro Audit Smart Contract≈Ø)**</small>
# Smart Contract Auditor Squad

## Kl√≠ƒçov√© Koncepty

### Smart Contract
Smart contract je samostatnƒõ spustiteln√Ω program na blockchainu, kter√Ω automaticky vykon√°v√° dohody mezi stranami bez pot≈ôeby prost≈ôedn√≠ka. V Ethereum ekosyst√©mu jsou ps√°ny p≈ôev√°≈ænƒõ v jazyce Solidity.

### Multi-Agent Syst√©m
Syst√©m slo≈æen√Ω z v√≠ce autonomn√≠ch AI agent≈Ø, kte≈ô√≠ spolupracuj√≠ na ≈ôe≈°en√≠ komplexn√≠ch √∫loh. Ka≈æd√Ω agent m√° specifickou roli a expert√≠zu.

### Vulnerability Detection
Proces identifikace bezpeƒçnostn√≠ch zranitelnost√≠ a chyb v k√≥du smart contract≈Ø, jako jsou reentrancy √∫toky, overflow/underflow, nebo nespr√°vn√° spr√°va p≈ô√≠stupov√Ωch pr√°v.

### LLM Agents
AI agenti postaven√≠ na velk√Ωch jazykov√Ωch modelech, kte≈ô√≠ dok√°≈æ√≠ analyzovat k√≥d, identifikovat probl√©my a navrhovat ≈ôe≈°en√≠ pomoc√≠ natural language processing.

### Collaborative Reporting
Proces, kdy v√≠ce agent≈Ø sd√≠l√≠ sv√© n√°lezy a spoleƒçnƒõ vytv√°≈ô√≠ komplexn√≠ audit report s konsolidovan√Ωmi doporuƒçen√≠mi.

## Komplexn√≠ Vysvƒõtlen√≠ Projektu

### C√≠le Projektu
Smart Contract Auditor Squad je pokroƒçil√Ω multi-agent syst√©m navr≈æen√Ω pro automatizaci a zlep≈°en√≠ procesu auditu smart contract≈Ø. Hlavn√≠mi c√≠li jsou:

1. **Automatick√° Detekce Zranitelnost√≠**: Identifikace bƒõ≈æn√Ωch i pokroƒçil√Ωch bezpeƒçnostn√≠ch probl√©m≈Ø
2. **Kolaborativn√≠ Anal√Ωza**: Vyu≈æit√≠ expertise r≈Øzn√Ωch specializovan√Ωch agent≈Ø
3. **Komplexn√≠ Reporting**: Generov√°n√≠ detailn√≠ch audit report≈Ø s doporuƒçen√≠mi
4. **≈†k√°lovatelnost**: Mo≈ænost auditovat velk√© mno≈æstv√≠ contract≈Ø efektivnƒõ

### V√Ωzvy a Probl√©my
- **Komplexnost Smart Contract≈Ø**: Modern√≠ DeFi protokoly jsou velmi slo≈æit√©
- **Evoluce Bezpeƒçnostn√≠ch Hrozeb**: Nov√© typy √∫tok≈Ø se objevuj√≠ kontinu√°lnƒõ
- **False Positives/Negatives**: Vyv√°≈æen√≠ mezi citlivost√≠ a p≈ôesnost√≠ detekce
- **Interoperabilita**: Podpora r≈Øzn√Ωch blockchain≈Ø a verz√≠ Solidity

### Potenci√°ln√≠ Dopad
Syst√©m m≈Ø≈æe v√Ωznamnƒõ sn√≠≈æit n√°klady na bezpeƒçnostn√≠ audity, zkr√°tit ƒças pot≈ôebn√Ω pro audit a zv√Ω≈°it celkovou bezpeƒçnost DeFi ekosyst√©mu.

## Komplexn√≠ P≈ô√≠klad s Python Implementac√≠

````python
import asyncio
import re
from typing import List, Dict, Any, Optional
from dataclasses import dataclass
from enum import Enum
import json
from datetime import datetime

# Z√°vislosti pro multi-agent framework
from crewai import Agent, Task, Crew
from langchain.llms import OpenAI
from langchain.tools import BaseTool
from langchain.schema import BaseMessage
import requests

class VulnerabilityType(Enum):
    REENTRANCY = "reentrancy"
    INTEGER_OVERFLOW = "integer_overflow"
    ACCESS_CONTROL = "access_control"
    UNCHECKED_EXTERNAL_CALLS = "unchecked_external_calls"
    DENIAL_OF_SERVICE = "denial_of_service"
    FRONT_RUNNING = "front_running"
    TIMESTAMP_DEPENDENCE = "timestamp_dependence"

@dataclass
class Vulnerability:
    type: VulnerabilityType
    severity: str  # "Critical", "High", "Medium", "Low"
    line_number: int
    description: str
    recommendation: str
    code_snippet: str

@dataclass
class AuditResult:
    contract_name: str
    vulnerabilities: List[Vulnerability]
    gas_optimization_suggestions: List[str]
    overall_score: int  # 0-100
    timestamp: datetime

class SmartContractAnalyzer:
    """N√°stroj pro z√°kladn√≠ anal√Ωzu smart contract≈Ø"""
    
    def __init__(self):
        self.vulnerability_patterns = {
            VulnerabilityType.REENTRANCY: [
                r'\.call\s*\(',
                r'\.send\s*\(',
                r'\.transfer\s*\('
            ],
            VulnerabilityType.INTEGER_OVERFLOW: [
                r'\+\+|\-\-',
                r'[\+\-\*\/]\s*=',
                r'[a-zA-Z_][a-zA-Z0-9_]*\s*[\+\-\*\/]\s*[a-zA-Z_][a-zA-Z0-9_]*'
            ],
            VulnerabilityType.ACCESS_CONTROL: [
                r'onlyOwner',
                r'require\s*\(\s*msg\.sender',
                r'modifier'
            ]
        }
    
    def analyze_contract(self, contract_code: str) -> List[Vulnerability]:
        """Analyzuje smart contract a vrac√≠ seznam zranitelnost√≠"""
        vulnerabilities = []
        lines = contract_code.split('\n')
        
        for i, line in enumerate(lines, 1):
            for vuln_type, patterns in self.vulnerability_patterns.items():
                for pattern in patterns:
                    if re.search(pattern, line, re.IGNORECASE):
                        severity = self._determine_severity(vuln_type, line)
                        vulnerabilities.append(Vulnerability(
                            type=vuln_type,
                            severity=severity,
                            line_number=i,
                            description=self._get_vulnerability_description(vuln_type),
                            recommendation=self._get_recommendation(vuln_type),
                            code_snippet=line.strip()
                        ))
        
        return vulnerabilities
    
    def _determine_severity(self, vuln_type: VulnerabilityType, code_line: str) -> str:
        """Urƒçuje z√°va≈ænost zranitelnosti"""
        critical_patterns = ['call(', 'delegatecall(']
        high_patterns = ['transfer(', 'send(']
        
        if any(pattern in code_line.lower() for pattern in critical_patterns):
            return "Critical"
        elif any(pattern in code_line.lower() for pattern in high_patterns):
            return "High"
        else:
            return "Medium"
    
    def _get_vulnerability_description(self, vuln_type: VulnerabilityType) -> str:
        descriptions = {
            VulnerabilityType.REENTRANCY: "Mo≈æn√Ω reentrancy √∫tok p≈ôes extern√≠ vol√°n√≠",
            VulnerabilityType.INTEGER_OVERFLOW: "Riziko integer overflow/underflow",
            VulnerabilityType.ACCESS_CONTROL: "Mo≈æn√© probl√©my s ≈ô√≠zen√≠m p≈ô√≠stupu"
        }
        return descriptions.get(vuln_type, "Nezn√°m√° zranitelnost")
    
    def _get_recommendation(self, vuln_type: VulnerabilityType) -> str:
        recommendations = {
            VulnerabilityType.REENTRANCY: "Pou≈æijte checks-effects-interactions pattern nebo ReentrancyGuard",
            VulnerabilityType.INTEGER_OVERFLOW: "Pou≈æijte SafeMath library nebo Solidity 0.8+",
            VulnerabilityType.ACCESS_CONTROL: "Implementujte proper access control modifiers"
        }
        return recommendations.get(vuln_type, "Konzultujte s bezpeƒçnostn√≠m expertem")

class SmartContractAuditorSquad:
    """Hlavn√≠ t≈ô√≠da pro multi-agent audit syst√©m"""
    
    def __init__(self, openai_api_key: str):
        self.llm = OpenAI(openai_api_key=openai_api_key, temperature=0.1)
        self.analyzer = SmartContractAnalyzer()
        self.setup_agents()
    
    def setup_agents(self):
        """Nastavuje specializovan√© agenty pro audit"""
        
        # Bezpeƒçnostn√≠ expert agent
        self.security_agent = Agent(
            role="Bezpeƒçnostn√≠ Expert",
            goal="Identifikovat kritick√© bezpeƒçnostn√≠ zranitelnosti v smart contractech",
            backstory="Jste zku≈°en√Ω bezpeƒçnostn√≠ auditor s 10+ lety zku≈°enost√≠ v blockchain bezpeƒçnosti.",
            llm=self.llm,
            verbose=True
        )
        
        # Gas optimalizaƒçn√≠ agent
        self.gas_optimizer = Agent(
            role="Gas Optimization Specialist",
            goal="Naj√≠t mo≈ænosti pro optimalizaci gas costs v smart contractech",
            backstory="Specializujete se na optimalizaci v√Ωkonu a n√°klad≈Ø smart contract≈Ø.",
            llm=self.llm,
            verbose=True
        )
        
        # Code quality agent
        self.code_reviewer = Agent(
            role="Code Quality Reviewer",
            goal="Hodnotit kvalitu k√≥du, ƒçitelnost a dodr≈æov√°n√≠ best practices",
            backstory="Jste senior developer s expert√≠zou v Solidity a smart contract developmentu.",
            llm=self.llm,
            verbose=True
        )
        
        # Report writer agent
        self.report_writer = Agent(
            role="Technical Report Writer",
            goal="Vytv√°≈ôet komplexn√≠ a srozumiteln√© audit reporty",
            backstory="Specializujete se na technickou dokumentaci a reporting.",
            llm=self.llm,
            verbose=True
        )
    
    async def audit_contract(self, contract_code: str, contract_name: str) -> AuditResult:
        """Prov√°d√≠ komplexn√≠ audit smart contractu"""
        
        # Z√°kladn√≠ anal√Ωza pomoc√≠ pattern matching
        basic_vulnerabilities = self.analyzer.analyze_contract(contract_code)
        
        # Vytvo≈ôen√≠ √∫kol≈Ø pro agenty
        security_task = Task(
            description=f"Analyzujte n√°sleduj√≠c√≠ smart contract a identifikujte v≈°echny bezpeƒçnostn√≠ zranitelnosti:\n\n{contract_code}",
            agent=self.security_agent
        )
        
        gas_task = Task(
            description=f"Analyzujte smart contract a navrhnƒõte optimalizace pro sn√≠≈æen√≠ gas costs:\n\n{contract_code}",
            agent=self.gas_optimizer
        )
        
        code_review_task = Task(
            description=f"Proveƒète code review n√°sleduj√≠c√≠ho smart contractu:\n\n{contract_code}",
            agent=self.code_reviewer
        )
        
        # Vytvo≈ôen√≠ crew a spu≈°tƒõn√≠ audit≈Ø
        audit_crew = Crew(
            agents=[self.security_agent, self.gas_optimizer, self.code_reviewer],
            tasks=[security_task, gas_task, code_review_task],
            verbose=True
        )
        
        # Spu≈°tƒõn√≠ audit crew
        crew_results = audit_crew.kickoff()
        
        # Zpracov√°n√≠ v√Ωsledk≈Ø a vytvo≈ôen√≠ fin√°ln√≠ho reportu
        report_task = Task(
            description=f"Na z√°kladƒõ n√°sleduj√≠c√≠ch audit v√Ωsledk≈Ø vytvo≈ôte komplexn√≠ report:\n{crew_results}",
            agent=self.report_writer
        )
        
        final_report_crew = Crew(
            agents=[self.report_writer],
            tasks=[report_task],
            verbose=True
        )
        
        final_report = final_report_crew.kickoff()
        
        # Kombinace z√°kladn√≠ anal√Ωzy s AI v√Ωsledky
        overall_score = self._calculate_overall_score(basic_vulnerabilities, crew_results)
        
        return AuditResult(
            contract_name=contract_name,
            vulnerabilities=basic_vulnerabilities,
            gas_optimization_suggestions=self._extract_gas_suggestions(crew_results),
            overall_score=overall_score,
            timestamp=datetime.now()
        )
    
    def _calculate_overall_score(self, vulnerabilities: List[Vulnerability], ai_results: str) -> int:
        """Vypoƒç√≠t√° celkov√© sk√≥re contractu (0-100)"""
        base_score = 100
        
        # Odeƒçten√≠ bod≈Ø za zranitelnosti
        for vuln in vulnerabilities:
            if vuln.severity == "Critical":
                base_score -= 25
            elif vuln.severity == "High":
                base_score -= 15
            elif vuln.severity == "Medium":
                base_score -= 10
            else:
                base_score -= 5
        
        return max(0, base_score)
    
    def _extract_gas_suggestions(self, ai_results: str) -> List[str]:
        """Extrahuje gas optimalizaƒçn√≠ n√°vrhy z AI v√Ωsledk≈Ø"""
        # Zjednodu≈°en√° implementace - v re√°ln√©m syst√©mu by byla sofistikovanƒõj≈°√≠
        suggestions = []
        if "gas" in ai_results.lower():
            suggestions.append("Optimalizujte storage operations")
            suggestions.append("Pou≈æijte packed structs")
            suggestions.append("Minimalizujte external calls")
        
        return suggestions
    
    def generate_report(self, audit_result: AuditResult) -> str:
        """Generuje fin√°ln√≠ audit report"""
        report = f"""
# Smart Contract Audit Report

## Z√°kladn√≠ Informace
- **Contract**: {audit_result.contract_name}
- **Datum Auditu**: {audit_result.timestamp.strftime('%Y-%m-%d %H:%M:%S')}
- **Celkov√© Sk√≥re**: {audit_result.overall_score}/100

## Identifikovan√© Zranitelnosti

"""
        
        for vuln in audit_result.vulnerabilities:
            report += f"""
### {vuln.type.value.upper()} - {vuln.severity}
- **≈ò√°dek**: {vuln.line_number}
- **Popis**: {vuln.description}
- **K√≥d**: `{vuln.code_snippet}`
- **Doporuƒçen√≠**: {vuln.recommendation}

"""
        
        report += f"""
## Gas Optimalizace

"""
        for suggestion in audit_result.gas_optimization_suggestions:
            report += f"- {suggestion}\n"
        
        report += f"""

## Z√°vƒõr

Contract dos√°hl sk√≥re {audit_result.overall_score}/100. 
{'KRITICK√â probl√©my vy≈æaduj√≠ okam≈æitou pozornost!' if audit_result.overall_score < 50 else 'Contract je v p≈ôijateln√©m stavu s nƒõkolika doporuƒçen√≠mi.'}
"""
        
        return report

# Uk√°zkov√Ω smart contract pro testov√°n√≠
SAMPLE_CONTRACT = """
pragma solidity ^0.8.0;

contract VulnerableBank {
    mapping(address => uint256) public balances;
    
    function deposit() public payable {
        balances[msg.sender] += msg.value;
    }
    
    function withdraw(uint256 amount) public {
        require(balances[msg.sender] >= amount, "Insufficient balance");
        
        // Vulnerability: External call before state change
        (bool success, ) = msg.sender.call{value: amount}("");
        require(success, "Transfer failed");
        
        balances[msg.sender] -= amount; // State change after external call
    }
    
    function emergencyWithdraw() public {
        // Vulnerability: No access control
        selfdestruct(payable(msg.sender));
    }
}
"""

async def main():
    """Hlavn√≠ funkce pro demonstraci syst√©mu"""
    # Pozn√°mka: V re√°ln√©m pou≈æit√≠ byste mƒõli nastavit skuteƒçn√Ω OpenAI API kl√≠ƒç
    auditor_squad = SmartContractAuditorSquad("your-openai-api-key")
    
    print("üîç Spou≈°t√≠m audit smart contractu...")
    
    try:
        # Proveden√≠ auditu
        audit_result = await auditor_squad.audit_contract(
            SAMPLE_CONTRACT, 
            "VulnerableBank"
        )
        
        # Generov√°n√≠ reportu
        report = auditor_squad.generate_report(audit_result)
        
        print("üìã Audit Report:")
        print("=" * 50)
        print(report)
        
        # Ulo≈æen√≠ reportu do souboru
        with open(f"audit_report_{audit_result.contract_name}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.md", "w", encoding="utf-8") as f:
            f.write(report)
        
        print(f"\n‚úÖ Audit dokonƒçen! Sk√≥re: {audit_result.overall_score}/100")
        
    except Exception as e:
        print(f"‚ùå Chyba bƒõhem auditu: {str(e)}")

if __name__ == "__main__":
    asyncio.run(main())
````

````python
crewai>=0.1.0
langchain>=0.1.0
openai>=1.0.0
asyncio
requests
dataclasses
enum34
````

````python
from setuptools import setup, find_packages

setup(
    name="smart-contract-auditor-squad",
    version="1.0.0",
    packages=find_packages(),
    install_requires=[
        "crewai>=0.1.0",
        "langchain>=0.1.0", 
        "openai>=1.0.0",
        "requests>=2.28.0",
    ],
    author="AI Developer",
    description="Multi-agent syst√©m pro audit smart contract≈Ø",
    python_requires=">=3.8",
)
````

## Instalace a Spu≈°tƒõn√≠

```bash
# Instalace z√°vislost√≠
pip install -r requirements.txt

# Nastaven√≠ API kl√≠ƒçe
export OPENAI_API_KEY="your-api-key-here"

# Spu≈°tƒõn√≠ auditu
python smart_contract_auditor.py
```

## Shrnut√≠ Projektu

Smart Contract Auditor Squad p≈ôedstavuje pokroƒçil√Ω p≈ô√≠stup k automatizaci bezpeƒçnostn√≠ch audit≈Ø v blockchain prost≈ôed√≠. Kl√≠ƒçov√© hodnoty projektu:

### Hodnota Projektu
- **Automatizace**: Sn√≠≈æen√≠ manu√°ln√≠ pr√°ce p≈ôi auditech o 70-80%
- **Konzistence**: Standardizovan√© postupy nap≈ô√≠ƒç v≈°emi audity
- **≈†k√°lovatelnost**: Mo≈ænost auditovat stovky contract≈Ø dennƒõ
- **Expert√≠za**: Kombinace rule-based detekce s AI inteligenc√≠

### Kl√≠ƒçov√© Poznatky
1. **Multi-agent p≈ô√≠stup** umo≈æ≈àuje specializaci na r≈Øzn√© aspekty auditu
2. **Kombinace pattern matching a LLM** poskytuje robustn√≠ detekci
3. **Strukturovan√© reporty** usnad≈àuj√≠ komunikaci s v√Ωvoj√°≈ôi
4. **Modul√°rn√≠ architektura** umo≈æ≈àuje snadn√© roz≈°√≠≈ôen√≠ o nov√© typy audit≈Ø

### Budouc√≠ Roz≈°√≠≈ôen√≠
- Integrace s dal≈°√≠ blockchain s√≠tƒõmi (Polygon, BSC, Avalanche)
- Pokroƒçil√° static analysis pomoc√≠ formal verification
- Real-time monitoring nasazen√Ωch contract≈Ø
- Integration s CI/CD pipeline pro kontinu√°ln√≠ audity

Syst√©m p≈ôedstavuje v√Ωznamn√Ω krok smƒõrem k bezpeƒçnƒõj≈°√≠mu DeFi ekosyst√©mu prost≈ôednictv√≠m dostupn√Ωch a efektivn√≠ch auditn√≠ch n√°stroj≈Ø.