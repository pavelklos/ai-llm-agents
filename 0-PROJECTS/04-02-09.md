<small>Claude Sonnet 4 **(Interactive Story Generator for Kids)**</small>
# Interactive Story Generator for Kids

## Key Concepts Explanation

### Creative Writing AI
Advanced natural language generation systems that produce imaginative, engaging narratives by understanding storytelling principles, character development, plot structures, and age-appropriate content creation for young audiences.

### Prompt Engineering
Strategic design and optimization of input prompts to guide AI models in generating specific types of content, including story themes, character traits, moral lessons, and narrative structures tailored for children's comprehension and engagement.

### Visual Storytelling
Integration of AI-generated images, illustrations, and visual elements with textual narratives to create immersive, multimedia storytelling experiences that enhance comprehension and engagement for visual learners.

### Audio Synthesis
Text-to-speech technology and voice generation systems that convert written stories into spoken narratives with expressive intonation, character voices, and sound effects to create audiobook-style experiences.

### Interactive Narrative Systems
Dynamic storytelling platforms that allow user input to influence plot direction, character decisions, and story outcomes, creating personalized and engaging reading experiences that adapt to user choices.

### Child-Safe Content Generation
AI systems designed with safety filters, age-appropriate content validation, and educational value assessment to ensure all generated content meets child development standards and parental expectations.

## Comprehensive Project Explanation

### Objectives
The Interactive Story Generator for Kids aims to revolutionize children's literature by creating personalized, educational, and engaging stories that adapt to individual preferences while incorporating visual and audio elements for immersive learning experiences.

### Key Features
- **Personalized Story Creation**: Custom narratives based on child's interests, age, and reading level
- **Interactive Story Branching**: User choices that influence plot development and character actions
- **Multi-modal Content**: Combined text, images, and audio for comprehensive storytelling
- **Educational Integration**: Stories that incorporate learning objectives and moral lessons
- **Character Customization**: Ability to create and include personalized characters
- **Progress Tracking**: Reading comprehension and engagement analytics for parents and educators

### Challenges
- **Content Safety**: Ensuring all generated content is appropriate and safe for children
- **Age Appropriateness**: Adapting vocabulary, themes, and complexity to different age groups
- **Educational Value**: Balancing entertainment with learning objectives and skill development
- **Attention Span**: Creating engaging content that maintains young readers' interest
- **Cultural Sensitivity**: Generating inclusive content that respects diverse backgrounds
- **Parental Controls**: Providing oversight and customization options for guardians

### Potential Impact
This system can enhance literacy development, spark creativity, provide personalized learning experiences, support diverse learning styles, and create new opportunities for educational technology in early childhood development.

## Comprehensive Project Example with Python Implementation

### Dependencies and Setup

````python
# requirements.txt
openai==1.6.1
langchain==0.1.0
langchain-openai==0.0.5
streamlit==1.29.0
streamlit-chat==0.1.1
pydantic==2.5.0
pillow==10.1.0
requests==2.31.0
gtts==2.4.0
pygame==2.5.2
pydub==0.25.1
matplotlib==3.8.2
plotly==5.17.0
pandas==2.1.4
numpy==1.24.3
python-dotenv==1.0.0
typing-extensions==4.8.0
dataclasses-json==0.6.3
stability-sdk==0.8.2
elevenlabs==0.2.26
````

### Core Implementation

````python
import os
import logging
import json
import uuid
import re
from typing import Dict, List, Optional, Tuple, Any, Union
from dataclasses import dataclass, field, asdict
from datetime import datetime
from enum import Enum
import streamlit as st
import pandas as pd
import numpy as np
from PIL import Image
import requests
import io
import base64

from langchain_openai import ChatOpenAI
from langchain.prompts import PromptTemplate, ChatPromptTemplate
from langchain.schema import BaseOutputParser
import openai
from gtts import gTTS
import pygame
from pydub import AudioSegment
import matplotlib.pyplot as plt
import plotly.express as px

# Configure logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

class AgeGroup(Enum):
    TODDLER = "2-4"
    PRESCHOOL = "4-6"
    EARLY_ELEMENTARY = "6-8"
    ELEMENTARY = "8-10"
    TWEEN = "10-12"

class StoryTheme(Enum):
    ADVENTURE = "adventure"
    FRIENDSHIP = "friendship"
    FAMILY = "family"
    ANIMALS = "animals"
    FANTASY = "fantasy"
    SCIENCE = "science"
    MYSTERY = "mystery"
    FAIRY_TALE = "fairy_tale"

class StoryLength(Enum):
    SHORT = "short"      # 200-400 words
    MEDIUM = "medium"    # 400-800 words
    LONG = "long"        # 800+ words

class ContentType(Enum):
    TEXT = "text"
    IMAGE = "image"
    AUDIO = "audio"
    INTERACTIVE = "interactive"

@dataclass
class Character:
    name: str
    description: str
    personality: List[str]
    appearance: str
    role: str = "main"
    age: Optional[str] = None
    special_abilities: List[str] = field(default_factory=list)

@dataclass
class StoryChoice:
    text: str
    consequence: str
    next_chapter: Optional[str] = None
    educational_value: Optional[str] = None

@dataclass
class StoryChapter:
    id: str
    title: str
    content: str
    choices: List[StoryChoice] = field(default_factory=list)
    image_prompt: Optional[str] = None
    audio_script: Optional[str] = None
    learning_objective: Optional[str] = None
    vocabulary_words: List[str] = field(default_factory=list)

@dataclass
class Story:
    id: str
    title: str
    theme: StoryTheme
    age_group: AgeGroup
    length: StoryLength
    characters: List[Character]
    chapters: List[StoryChapter]
    moral_lesson: str
    educational_goals: List[str]
    created_date: datetime
    reading_time_minutes: int
    difficulty_level: float  # 1-10 scale

@dataclass
class UserProfile:
    id: str
    name: str
    age: int
    age_group: AgeGroup
    interests: List[str]
    reading_level: str
    favorite_characters: List[str] = field(default_factory=list)
    completed_stories: List[str] = field(default_factory=list)
    preferred_themes: List[StoryTheme] = field(default_factory=list)
    learning_goals: List[str] = field(default_factory=list)

class ContentSafetyFilter:
    """Ensure all generated content is child-appropriate."""
    
    def __init__(self):
        self.prohibited_words = [
            'violence', 'scary', 'dangerous', 'hurt', 'sad', 'angry',
            'fight', 'weapon', 'death', 'kill', 'hate', 'bad'
        ]
        
        self.replacement_words = {
            'scary': 'surprising',
            'dangerous': 'challenging',
            'hurt': 'uncomfortable',
            'fight': 'disagree',
            'angry': 'frustrated',
            'bad': 'not great'
        }
    
    def filter_content(self, content: str) -> str:
        """Filter and clean content for child safety."""
        filtered_content = content.lower()
        
        # Replace problematic words
        for word, replacement in self.replacement_words.items():
            filtered_content = filtered_content.replace(word, replacement)
        
        # Remove prohibited content
        for word in self.prohibited_words:
            if word in filtered_content and word not in self.replacement_words:
                filtered_content = filtered_content.replace(word, '[content filtered]')
        
        return filtered_content.title()
    
    def validate_content(self, content: str) -> Tuple[bool, List[str]]:
        """Validate content and return safety status with issues."""
        issues = []
        content_lower = content.lower()
        
        for word in self.prohibited_words:
            if word in content_lower:
                issues.append(f"Contains potentially inappropriate word: {word}")
        
        # Check for complexity (reading level)
        word_count = len(content.split())
        avg_word_length = sum(len(word) for word in content.split()) / word_count if word_count > 0 else 0
        
        if avg_word_length > 7:
            issues.append("Language may be too complex for young readers")
        
        is_safe = len(issues) == 0
        return is_safe, issues

class StoryGenerator:
    """Advanced story generation using LLM with educational focus."""
    
    def __init__(self, openai_api_key: str):
        self.llm = ChatOpenAI(
            temperature=0.8,
            model_name="gpt-4",
            openai_api_key=openai_api_key
        )
        
        self.safety_filter = ContentSafetyFilter()
        
        # Story generation prompts
        self.story_prompt = ChatPromptTemplate.from_template("""
        Create an engaging, educational story for children with the following specifications:
        
        Age Group: {age_group}
        Theme: {theme}
        Length: {length}
        Main Character: {main_character}
        Supporting Characters: {supporting_characters}
        Learning Objective: {learning_objective}
        Moral Lesson: {moral_lesson}
        
        User Interests: {interests}
        Special Requirements: {special_requirements}
        
        Story Requirements:
        - Age-appropriate vocabulary and concepts
        - Positive, encouraging tone
        - Educational value integrated naturally
        - Clear moral lesson
        - Engaging plot with relatable characters
        - Safe and appropriate content
        - Interactive elements for reader engagement
        
        Create a complete story with:
        1. Compelling title
        2. Well-developed characters
        3. Engaging plot with beginning, middle, and end
        4. Educational elements woven throughout
        5. Positive resolution with clear moral lesson
        
        Format the response as a structured story with clear chapters.
        
        Story:
        """)
        
        self.chapter_prompt = ChatPromptTemplate.from_template("""
        Create the next chapter of this ongoing story:
        
        Previous Story Context:
        {previous_context}
        
        Current Chapter Requirements:
        - Age Group: {age_group}
        - Chapter Focus: {chapter_focus}
        - Educational Goal: {educational_goal}
        - Length: {target_length} words
        
        Character Development:
        {character_development}
        
        Plot Requirements:
        - Continue the narrative smoothly
        - Include 2-3 interactive choices for readers
        - Maintain educational value
        - Age-appropriate language and content
        - Engaging and positive tone
        
        Create the chapter with interactive choices that allow readers to influence the story direction.
        
        Chapter:
        """)
    
    def generate_story(self, user_profile: UserProfile, preferences: Dict[str, Any]) -> Story:
        """Generate a complete interactive story."""
        try:
            # Extract preferences
            theme = StoryTheme(preferences.get('theme', 'adventure'))
            length = StoryLength(preferences.get('length', 'medium'))
            learning_objective = preferences.get('learning_objective', 'Reading comprehension')
            moral_lesson = preferences.get('moral_lesson', 'The importance of kindness and friendship')
            
            # Create main character
            main_character = self._create_main_character(user_profile, preferences)
            supporting_characters = self._create_supporting_characters(theme, user_profile.age_group)
            
            # Generate story content
            story_response = self.llm.invoke(self.story_prompt.format(
                age_group=user_profile.age_group.value,
                theme=theme.value,
                length=length.value,
                main_character=main_character.name,
                supporting_characters=', '.join([c.name for c in supporting_characters]),
                learning_objective=learning_objective,
                moral_lesson=moral_lesson,
                interests=', '.join(user_profile.interests),
                special_requirements=preferences.get('special_requirements', 'None')
            ))
            
            # Parse and structure the story
            story_content = story_response.content
            
            # Filter content for safety
            story_content = self.safety_filter.filter_content(story_content)
            
            # Create story structure
            story = self._structure_story(
                story_content, 
                theme, 
                user_profile.age_group, 
                length,
                [main_character] + supporting_characters,
                learning_objective,
                moral_lesson
            )
            
            return story
            
        except Exception as e:
            logger.error(f"Story generation error: {e}")
            return self._create_fallback_story(user_profile, preferences)
    
    def generate_interactive_chapter(self, story_context: str, user_choice: str, 
                                   user_profile: UserProfile) -> StoryChapter:
        """Generate next chapter based on user choice."""
        try:
            chapter_response = self.llm.invoke(self.chapter_prompt.format(
                previous_context=story_context,
                age_group=user_profile.age_group.value,
                chapter_focus=user_choice,
                educational_goal="Continue learning through story engagement",
                target_length=200 if user_profile.age_group in [AgeGroup.TODDLER, AgeGroup.PRESCHOOL] else 400,
                character_development="Develop character growth and problem-solving skills"
            ))
            
            chapter_content = self.safety_filter.filter_content(chapter_response.content)
            
            # Create chapter with choices
            chapter = StoryChapter(
                id=str(uuid.uuid4()),
                title=f"Chapter: {user_choice}",
                content=chapter_content,
                choices=self._generate_choices(chapter_content, user_profile.age_group),
                learning_objective="Interactive decision making",
                vocabulary_words=self._extract_vocabulary(chapter_content, user_profile.age_group)
            )
            
            return chapter
            
        except Exception as e:
            logger.error(f"Interactive chapter generation error: {e}")
            return self._create_fallback_chapter()
    
    def _create_main_character(self, user_profile: UserProfile, preferences: Dict) -> Character:
        """Create a personalized main character."""
        character_name = preferences.get('character_name', user_profile.name)
        
        # Age-appropriate character traits
        age_traits = {
            AgeGroup.TODDLER: ["curious", "playful", "gentle"],
            AgeGroup.PRESCHOOL: ["adventurous", "kind", "creative"],
            AgeGroup.EARLY_ELEMENTARY: ["brave", "smart", "helpful"],
            AgeGroup.ELEMENTARY: ["determined", "loyal", "clever"],
            AgeGroup.TWEEN: ["resourceful", "empathetic", "independent"]
        }
        
        personality = age_traits.get(user_profile.age_group, ["kind", "brave", "curious"])
        
        return Character(
            name=character_name,
            description=f"A {personality[0]} child who loves {', '.join(user_profile.interests[:2])}",
            personality=personality,
            appearance=preferences.get('character_appearance', "friendly and approachable"),
            role="protagonist"
        )
    
    def _create_supporting_characters(self, theme: StoryTheme, age_group: AgeGroup) -> List[Character]:
        """Create theme-appropriate supporting characters."""
        theme_characters = {
            StoryTheme.ANIMALS: [
                Character("Buddy", "A loyal dog companion", ["faithful", "protective"], "golden retriever", "friend"),
                Character("Whiskers", "A wise old cat", ["wise", "mysterious"], "gray tabby", "mentor")
            ],
            StoryTheme.ADVENTURE: [
                Character("Captain Explorer", "An experienced guide", ["brave", "knowledgeable"], "tall with a compass", "mentor"),
                Character("Scout", "A helpful friend", ["enthusiastic", "supportive"], "energetic and friendly", "friend")
            ],
            StoryTheme.FRIENDSHIP: [
                Character("Alex", "A new friend", ["shy", "kind"], "curly hair and bright smile", "friend"),
                Character("Sam", "The group organizer", ["outgoing", "inclusive"], "confident and welcoming", "leader")
            ]
        }
        
        return theme_characters.get(theme, [
            Character("Helper", "A kind friend", ["supportive", "caring"], "warm and friendly", "friend")
        ])[:2]  # Limit to 2 supporting characters
    
    def _structure_story(self, content: str, theme: StoryTheme, age_group: AgeGroup, 
                        length: StoryLength, characters: List[Character], 
                        learning_objective: str, moral_lesson: str) -> Story:
        """Structure raw story content into organized chapters."""
        
        # Split content into chapters (simplified)
        paragraphs = content.split('\n\n')
        
        # Determine chapter count based on length and age
        chapter_count = {
            StoryLength.SHORT: 3,
            StoryLength.MEDIUM: 5,
            StoryLength.LONG: 7
        }.get(length, 3)
        
        # Adjust for age group
        if age_group in [AgeGroup.TODDLER, AgeGroup.PRESCHOOL]:
            chapter_count = min(chapter_count, 3)
        
        chapters = []
        paragraphs_per_chapter = max(1, len(paragraphs) // chapter_count)
        
        for i in range(chapter_count):
            start_idx = i * paragraphs_per_chapter
            end_idx = start_idx + paragraphs_per_chapter
            chapter_content = '\n\n'.join(paragraphs[start_idx:end_idx])
            
            if chapter_content.strip():
                chapter = StoryChapter(
                    id=str(uuid.uuid4()),
                    title=f"Chapter {i + 1}",
                    content=chapter_content,
                    choices=self._generate_choices(chapter_content, age_group),
                    learning_objective=learning_objective,
                    vocabulary_words=self._extract_vocabulary(chapter_content, age_group)
                )
                chapters.append(chapter)
        
        # Calculate reading time
        word_count = len(content.split())
        reading_time = self._calculate_reading_time(word_count, age_group)
        
        return Story(
            id=str(uuid.uuid4()),
            title=self._extract_title(content),
            theme=theme,
            age_group=age_group,
            length=length,
            characters=characters,
            chapters=chapters,
            moral_lesson=moral_lesson,
            educational_goals=[learning_objective],
            created_date=datetime.now(),
            reading_time_minutes=reading_time,
            difficulty_level=self._calculate_difficulty(content, age_group)
        )
    
    def _generate_choices(self, content: str, age_group: AgeGroup) -> List[StoryChoice]:
        """Generate interactive choices for the chapter."""
        # Age-appropriate choice complexity
        choice_templates = {
            AgeGroup.TODDLER: [
                "What should [character] do next?",
                "How should [character] help?"
            ],
            AgeGroup.PRESCHOOL: [
                "What would you choose?",
                "What's the best way to solve this?"
            ],
            AgeGroup.EARLY_ELEMENTARY: [
                "What decision should [character] make?",
                "How can [character] overcome this challenge?"
            ]
        }
        
        templates = choice_templates.get(age_group, choice_templates[AgeGroup.PRESCHOOL])
        
        choices = [
            StoryChoice(
                text="Continue the adventure",
                consequence="The story continues with new discoveries",
                educational_value="Decision making"
            ),
            StoryChoice(
                text="Help a friend",
                consequence="Friendship grows stronger",
                educational_value="Empathy and cooperation"
            )
        ]
        
        return choices
    
    def _extract_vocabulary(self, content: str, age_group: AgeGroup) -> List[str]:
        """Extract age-appropriate vocabulary words for learning."""
        words = content.split()
        
        # Filter for educational vocabulary based on age
        min_length = {
            AgeGroup.TODDLER: 4,
            AgeGroup.PRESCHOOL: 5,
            AgeGroup.EARLY_ELEMENTARY: 6,
            AgeGroup.ELEMENTARY: 7,
            AgeGroup.TWEEN: 8
        }.get(age_group, 5)
        
        vocabulary = []
        for word in words:
            clean_word = re.sub(r'[^\w]', '', word.lower())
            if len(clean_word) >= min_length and clean_word.isalpha():
                vocabulary.append(clean_word)
        
        return list(set(vocabulary))[:10]  # Return unique words, max 10
    
    def _extract_title(self, content: str) -> str:
        """Extract or generate story title."""
        lines = content.split('\n')
        
        # Look for title in first few lines
        for line in lines[:3]:
            if len(line.split()) <= 8 and line.strip():
                return line.strip()
        
        return "A Wonderful Adventure"
    
    def _calculate_reading_time(self, word_count: int, age_group: AgeGroup) -> int:
        """Calculate estimated reading time based on age group."""
        words_per_minute = {
            AgeGroup.TODDLER: 50,
            AgeGroup.PRESCHOOL: 75,
            AgeGroup.EARLY_ELEMENTARY: 100,
            AgeGroup.ELEMENTARY: 125,
            AgeGroup.TWEEN: 150
        }.get(age_group, 100)
        
        return max(1, word_count // words_per_minute)
    
    def _calculate_difficulty(self, content: str, age_group: AgeGroup) -> float:
        """Calculate story difficulty on 1-10 scale."""
        words = content.split()
        avg_word_length = sum(len(word) for word in words) / len(words) if words else 0
        
        # Base difficulty by age group
        base_difficulty = {
            AgeGroup.TODDLER: 2.0,
            AgeGroup.PRESCHOOL: 3.5,
            AgeGroup.EARLY_ELEMENTARY: 5.0,
            AgeGroup.ELEMENTARY: 6.5,
            AgeGroup.TWEEN: 8.0
        }.get(age_group, 5.0)
        
        # Adjust based on word complexity
        complexity_adjustment = (avg_word_length - 4) * 0.5
        
        return max(1.0, min(10.0, base_difficulty + complexity_adjustment))
    
    def _create_fallback_story(self, user_profile: UserProfile, preferences: Dict) -> Story:
        """Create a simple fallback story if generation fails."""
        main_character = Character(
            name=user_profile.name,
            description="A kind and curious child",
            personality=["kind", "curious", "brave"],
            appearance="friendly",
            role="protagonist"
        )
        
        fallback_chapter = StoryChapter(
            id=str(uuid.uuid4()),
            title="A Simple Adventure",
            content=f"Once upon a time, {user_profile.name} went on a wonderful adventure and learned something new!",
            choices=[
                StoryChoice("Continue exploring", "New discoveries await!", "Curiosity"),
                StoryChoice("Help someone", "Kindness makes friends!", "Empathy")
            ],
            learning_objective="Basic story structure",
            vocabulary_words=["adventure", "wonderful", "learned"]
        )
        
        return Story(
            id=str(uuid.uuid4()),
            title="A Simple Adventure",
            theme=StoryTheme.ADVENTURE,
            age_group=user_profile.age_group,
            length=StoryLength.SHORT,
            characters=[main_character],
            chapters=[fallback_chapter],
            moral_lesson="Every day brings new opportunities to learn and grow",
            educational_goals=["Reading comprehension"],
            created_date=datetime.now(),
            reading_time_minutes=5,
            difficulty_level=3.0
        )
    
    def _create_fallback_chapter(self) -> StoryChapter:
        """Create a simple fallback chapter."""
        return StoryChapter(
            id=str(uuid.uuid4()),
            title="Continue the Story",
            content="The adventure continues with new friends and exciting discoveries!",
            choices=[
                StoryChoice("Keep going", "More fun ahead!", "Perseverance"),
                StoryChoice("Take a break", "Rest and think", "Reflection")
            ],
            learning_objective="Story continuation",
            vocabulary_words=["adventure", "friends", "discoveries"]
        )

class VisualGenerator:
    """Generate child-friendly illustrations for stories."""
    
    def __init__(self, openai_api_key: str):
        self.openai_client = openai.OpenAI(api_key=openai_api_key)
    
    def generate_story_illustration(self, chapter: StoryChapter, 
                                  characters: List[Character], 
                                  age_group: AgeGroup) -> Optional[str]:
        """Generate illustration for story chapter."""
        try:
            # Create child-friendly prompt
            prompt = self._create_image_prompt(chapter, characters, age_group)
            
            response = self.openai_client.images.generate(
                model="dall-e-3",
                prompt=prompt,
                size="1024x1024",
                quality="standard",
                n=1,
                style="vivid"
            )
            
            return response.data[0].url
            
        except Exception as e:
            logger.error(f"Image generation error: {e}")
            return None
    
    def _create_image_prompt(self, chapter: StoryChapter, 
                           characters: List[Character], 
                           age_group: AgeGroup) -> str:
        """Create child-appropriate image generation prompt."""
        
        base_prompt = f"""
        Create a cheerful, colorful illustration for a children's story.
        Style: Child-friendly cartoon illustration, bright colors, safe and happy environment.
        
        Characters: {', '.join([f"{c.name} ({c.description})" for c in characters[:2]])}
        Scene: {chapter.content[:200]}...
        
        Requirements:
        - Completely safe for children
        - Bright, cheerful colors
        - Cartoon/animated style
        - No scary or dark elements
        - Educational and positive themes
        - Age-appropriate for {age_group.value} year olds
        """
        
        return base_prompt.strip()

class AudioGenerator:
    """Generate narration and sound effects for stories."""
    
    def __init__(self):
        pygame.mixer.init()
        self.current_audio = None
    
    def generate_narration(self, text: str, language: str = 'en', 
                          voice_speed: float = 1.0) -> Optional[str]:
        """Generate text-to-speech narration."""
        try:
            # Clean text for TTS
            clean_text = re.sub(r'[^\w\s.,!?]', '', text)
            
            # Generate TTS
            tts = gTTS(text=clean_text, lang=language, slow=(voice_speed < 1.0))
            
            # Save to temporary file
            audio_file = f"temp_audio_{uuid.uuid4()}.mp3"
            tts.save(audio_file)
            
            return audio_file
            
        except Exception as e:
            logger.error(f"Audio generation error: {e}")
            return None
    
    def play_audio(self, audio_file: str):
        """Play audio file."""
        try:
            pygame.mixer.music.load(audio_file)
            pygame.mixer.music.play()
            self.current_audio = audio_file
            
        except Exception as e:
            logger.error(f"Audio playback error: {e}")
    
    def stop_audio(self):
        """Stop current audio playback."""
        try:
            pygame.mixer.music.stop()
        except:
            pass
    
    def generate_character_voice(self, character: Character, text: str) -> Optional[str]:
        """Generate character-specific voice narration."""
        # Simplified character voice generation
        # In practice, this would use more advanced voice synthesis
        return self.generate_narration(text)

class StoryManager:
    """Manage story sessions and user progress."""
    
    def __init__(self):
        self.current_story: Optional[Story] = None
        self.current_chapter_index: int = 0
        self.user_choices: List[str] = []
        self.reading_progress: Dict[str, Any] = {}
    
    def start_story(self, story: Story):
        """Initialize a new story session."""
        self.current_story = story
        self.current_chapter_index = 0
        self.user_choices = []
        self.reading_progress = {
            'start_time': datetime.now(),
            'chapters_read': 0,
            'choices_made': 0,
            'vocabulary_learned': []
        }
    
    def get_current_chapter(self) -> Optional[StoryChapter]:
        """Get the current chapter being read."""
        if (self.current_story and 
            0 <= self.current_chapter_index < len(self.current_story.chapters)):
            return self.current_story.chapters[self.current_chapter_index]
        return None
    
    def make_choice(self, choice: StoryChoice) -> bool:
        """Process user choice and advance story."""
        self.user_choices.append(choice.text)
        self.reading_progress['choices_made'] += 1
        
        # Advance to next chapter
        self.current_chapter_index += 1
        self.reading_progress['chapters_read'] += 1
        
        return self.current_chapter_index < len(self.current_story.chapters) if self.current_story else False
    
    def get_progress_summary(self) -> Dict[str, Any]:
        """Get reading session progress summary."""
        if not self.current_story:
            return {}
        
        elapsed_time = datetime.now() - self.reading_progress['start_time']
        
        return {
            'story_title': self.current_story.title,
            'chapters_completed': self.reading_progress['chapters_read'],
            'total_chapters': len(self.current_story.chapters),
            'completion_percentage': (self.reading_progress['chapters_read'] / len(self.current_story.chapters)) * 100,
            'reading_time_minutes': elapsed_time.total_seconds() / 60,
            'choices_made': self.reading_progress['choices_made'],
            'vocabulary_learned': len(self.reading_progress.get('vocabulary_learned', []))
        }

def create_sample_user_profiles() -> List[UserProfile]:
    """Create sample user profiles for demonstration."""
    return [
        UserProfile(
            id="user_001",
            name="Emma",
            age=6,
            age_group=AgeGroup.EARLY_ELEMENTARY,
            interests=["animals", "nature", "friendship"],
            reading_level="beginner",
            preferred_themes=[StoryTheme.ANIMALS, StoryTheme.FRIENDSHIP],
            learning_goals=["vocabulary building", "reading comprehension"]
        ),
        UserProfile(
            id="user_002", 
            name="Alex",
            age=9,
            age_group=AgeGroup.ELEMENTARY,
            interests=["adventure", "science", "mystery"],
            reading_level="intermediate",
            preferred_themes=[StoryTheme.ADVENTURE, StoryTheme.SCIENCE],
            learning_goals=["critical thinking", "problem solving"]
        ),
        UserProfile(
            id="user_003",
            name="Maya",
            age=4,
            age_group=AgeGroup.PRESCHOOL,
            interests=["fairy tales", "magic", "colors"],
            reading_level="picture books",
            preferred_themes=[StoryTheme.FAIRY_TALE, StoryTheme.FANTASY],
            learning_goals=["language development", "imagination"]
        )
    ]

def main():
    """Main Streamlit application."""
    st.set_page_config(
        page_title="Interactive Story Generator for Kids",
        page_icon="üìö",
        layout="wide"
    )
    
    st.title("üìö Interactive Story Generator for Kids")
    st.markdown("Create personalized, educational stories that adapt to your child's interests and choices!")
    
    # Sidebar configuration
    with st.sidebar:
        st.header("‚öôÔ∏è Story Settings")
        openai_api_key = st.text_input("OpenAI API Key", type="password")
        
        if st.button("üìñ Load Sample Profiles"):
            st.session_state['sample_profiles'] = create_sample_user_profiles()
            st.success("Sample user profiles loaded!")
        
        # User profile selection
        if 'sample_profiles' in st.session_state:
            profile_names = [p.name for p in st.session_state['sample_profiles']]
            selected_profile_name = st.selectbox("Select Reader", profile_names)
            
            # Get selected profile
            selected_profile = next(
                (p for p in st.session_state['sample_profiles'] if p.name == selected_profile_name),
                None
            )
            
            if selected_profile:
                st.write(f"**Age:** {selected_profile.age} years")
                st.write(f"**Reading Level:** {selected_profile.reading_level}")
                st.write(f"**Interests:** {', '.join(selected_profile.interests)}")
        
        st.header("üé® Story Preferences")
        story_theme = st.selectbox(
            "Story Theme",
            [theme.value.replace('_', ' ').title() for theme in StoryTheme]
        )
        
        story_length = st.selectbox(
            "Story Length",
            [length.value.title() for length in StoryLength]
        )
        
        moral_lesson = st.text_area(
            "Moral Lesson (optional)",
            placeholder="What lesson should the story teach?"
        )
        
        include_audio = st.checkbox("Include Audio Narration", value=True)
        include_images = st.checkbox("Generate Illustrations", value=True)
    
    if not openai_api_key:
        st.warning("Please enter your OpenAI API key in the sidebar to continue.")
        return
    
    # Initialize components
    try:
        story_generator = StoryGenerator(openai_api_key)
        visual_generator = VisualGenerator(openai_api_key) if include_images else None
        audio_generator = AudioGenerator() if include_audio else None
        story_manager = StoryManager()
        
    except Exception as e:
        st.error(f"Error initializing components: {e}")
        return
    
    # Main interface tabs
    tab1, tab2, tab3, tab4 = st.tabs([
        "üìñ Story Reader", 
        "üé® Create Story", 
        "üìä Progress", 
        "‚öôÔ∏è Settings"
    ])
    
    with tab1:
        st.header("üìñ Interactive Story Reader")
        
        # Display current story
        if 'current_story' in st.session_state:
            story = st.session_state['current_story']
            current_chapter = story_manager.get_current_chapter()
            
            if current_chapter:
                st.subheader(f"üìö {story.title}")
                st.write(f"**{current_chapter.title}**")
                
                # Display chapter content
                with st.container():
                    st.write(current_chapter.content)
                
                # Show illustration if available
                if include_images and 'chapter_image' in st.session_state:
                    st.image(st.session_state['chapter_image'], caption="Story Illustration")
                
                # Audio controls
                if include_audio:
                    col1, col2, col3 = st.columns([1, 1, 2])
                    
                    with col1:
                        if st.button("üîä Play Audio"):
                            with st.spinner("Generating audio..."):
                                try:
                                    audio_file = audio_generator.generate_narration(current_chapter.content)
                                    if audio_file:
                                        audio_generator.play_audio(audio_file)
                                        st.success("Playing audio!")
                                except Exception as e:
                                    st.error(f"Audio error: {e}")
                    
                    with col2:
                        if st.button("‚èπÔ∏è Stop Audio"):
                            audio_generator.stop_audio()
                
                # Interactive choices
                if current_chapter.choices:
                    st.subheader("ü§î What happens next?")
                    
                    for i, choice in enumerate(current_chapter.choices):
                        if st.button(f"‚ú® {choice.text}", key=f"choice_{i}"):
                            # Process choice
                            has_next = story_manager.make_choice(choice)
                            
                            if has_next:
                                # Generate next chapter based on choice
                                with st.spinner("Creating next chapter..."):
                                    try:
                                        if 'sample_profiles' in st.session_state and selected_profile:
                                            next_chapter = story_generator.generate_interactive_chapter(
                                                current_chapter.content,
                                                choice.text,
                                                selected_profile
                                            )
                                            
                                            # Add to story
                                            story.chapters.append(next_chapter)
                                            st.session_state['current_story'] = story
                                            
                                            # Generate illustration for new chapter
                                            if include_images and visual_generator:
                                                image_url = visual_generator.generate_story_illustration(
                                                    next_chapter, story.characters, story.age_group
                                                )
                                                if image_url:
                                                    st.session_state['chapter_image'] = image_url
                                            
                                            st.rerun()
                                            
                                    except Exception as e:
                                        st.error(f"Error generating next chapter: {e}")
                            else:
                                st.success("üéâ Story completed! Great reading!")
                                
                                # Show completion summary
                                progress = story_manager.get_progress_summary()
                                st.write("**Reading Summary:**")
                                st.write(f"- Chapters read: {progress.get('chapters_completed', 0)}")
                                st.write(f"- Choices made: {progress.get('choices_made', 0)}")
                                st.write(f"- Reading time: {progress.get('reading_time_minutes', 0):.1f} minutes")
                
                # Vocabulary learning section
                if current_chapter.vocabulary_words:
                    with st.expander("üìù New Words to Learn"):
                        for word in current_chapter.vocabulary_words:
                            st.write(f"‚Ä¢ **{word.title()}**")
            
            else:
                st.info("Story completed! Create a new story to continue reading.")
        
        else:
            st.info("Create a new story in the 'Create Story' tab to start reading!")
    
    with tab2:
        st.header("üé® Create Your Personalized Story")
        
        if 'sample_profiles' in st.session_state and selected_profile:
            # Story creation form
            with st.form("story_creation_form"):
                st.subheader(f"Creating story for {selected_profile.name}")
                
                col1, col2 = st.columns(2)
                
                with col1:
                    character_name = st.text_input("Main Character Name", value=selected_profile.name)
                    character_appearance = st.text_area(
                        "Character Description",
                        placeholder="Describe how the character looks..."
                    )
                
                with col2:
                    learning_objective = st.selectbox(
                        "Learning Goal",
                        ["Reading Comprehension", "Vocabulary Building", "Problem Solving", 
                         "Emotional Intelligence", "Science Concepts", "Math Skills"]
                    )
                    
                    special_requirements = st.text_area(
                        "Special Requests",
                        placeholder="Any special themes or requirements?"
                    )
                
                submitted = st.form_submit_button("‚ú® Create Story")
                
                if submitted:
                    with st.spinner("Creating your personalized story..."):
                        try:
                            # Prepare story preferences
                            preferences = {
                                'theme': story_theme.lower().replace(' ', '_'),
                                'length': story_length.lower(),
                                'character_name': character_name,
                                'character_appearance': character_appearance,
                                'learning_objective': learning_objective,
                                'moral_lesson': moral_lesson or "The importance of kindness and perseverance",
                                'special_requirements': special_requirements
                            }
                            
                            # Generate story
                            story = story_generator.generate_story(selected_profile, preferences)
                            
                            # Initialize story manager
                            story_manager.start_story(story)
                            st.session_state['current_story'] = story
                            
                            # Generate illustration for first chapter
                            if include_images and visual_generator and story.chapters:
                                image_url = visual_generator.generate_story_illustration(
                                    story.chapters[0], story.characters, story.age_group
                                )
                                if image_url:
                                    st.session_state['chapter_image'] = image_url
                            
                            st.success(f"‚ú® Created '{story.title}' for {selected_profile.name}!")
                            st.info("Go to the 'Story Reader' tab to start reading!")
                            
                        except Exception as e:
                            st.error(f"Error creating story: {e}")
            
            # Story preview
            if 'current_story' in st.session_state:
                story = st.session_state['current_story']
                
                with st.expander("üìã Story Details"):
                    col1, col2 = st.columns(2)
                    
                    with col1:
                        st.write(f"**Title:** {story.title}")
                        st.write(f"**Theme:** {story.theme.value.title()}")
                        st.write(f"**Age Group:** {story.age_group.value}")
                        st.write(f"**Estimated Reading Time:** {story.reading_time_minutes} minutes")
                    
                    with col2:
                        st.write(f"**Difficulty Level:** {story.difficulty_level:.1f}/10")
                        st.write(f"**Chapters:** {len(story.chapters)}")
                        st.write(f"**Characters:** {len(story.characters)}")
                        st.write(f"**Moral Lesson:** {story.moral_lesson}")
                    
                    # Character information
                    st.subheader("üë• Characters")
                    for character in story.characters:
                        st.write(f"**{character.name}** ({character.role}): {character.description}")
        
        else:
            st.warning("Please load sample profiles and select a reader first.")
    
    with tab3:
        st.header("üìä Reading Progress & Analytics")
        
        if 'current_story' in st.session_state:
            progress = story_manager.get_progress_summary()
            
            # Progress metrics
            col1, col2, col3, col4 = st.columns(4)
            
            with col1:
                st.metric("Completion", f"{progress.get('completion_percentage', 0):.0f}%")
            with col2:
                st.metric("Chapters Read", progress.get('chapters_completed', 0))
            with col3:
                st.metric("Reading Time", f"{progress.get('reading_time_minutes', 0):.1f} min")
            with col4:
                st.metric("Choices Made", progress.get('choices_made', 0))
            
            # Progress visualization
            if progress.get('chapters_completed', 0) > 0:
                completion_data = pd.DataFrame({
                    'Status': ['Completed', 'Remaining'],
                    'Chapters': [
                        progress.get('chapters_completed', 0),
                        progress.get('total_chapters', 0) - progress.get('chapters_completed', 0)
                    ]
                })
                
                fig = px.pie(completion_data, values='Chapters', names='Status', 
                           title="Reading Progress")
                st.plotly_chart(fig)
            
            # Reading streaks and achievements
            st.subheader("üèÜ Achievements")
            
            achievements = []
            if progress.get('chapters_completed', 0) >= 1:
                achievements.append("üìñ First Chapter Complete!")
            if progress.get('choices_made', 0) >= 3:
                achievements.append("ü§î Decision Maker!")
            if progress.get('completion_percentage', 0) >= 100:
                achievements.append("üéâ Story Master!")
            
            for achievement in achievements:
                st.success(achievement)
            
            if not achievements:
                st.info("Complete chapters and make choices to earn achievements!")
        
        else:
            st.info("Start reading a story to see progress analytics!")
        
        # Reading recommendations
        if 'sample_profiles' in st.session_state and selected_profile:
            st.subheader("üìö Recommended Stories")
            
            # Simulate story recommendations based on profile
            recommendations = [
                f"ü¶Ñ Magic Forest Adventure (Theme: {StoryTheme.FANTASY.value})",
                f"üêï Best Friends Forever (Theme: {StoryTheme.FRIENDSHIP.value})",
                f"üöÄ Space Explorer (Theme: {StoryTheme.SCIENCE.value})"
            ]
            
            for rec in recommendations:
                if st.button(rec, key=f"rec_{rec}"):
                    st.info("Story recommendation selected! This would create a new story.")
    
    with tab4:
        st.header("‚öôÔ∏è Settings & Preferences")
        
        # Audio settings
        st.subheader("üîä Audio Settings")
        
        col1, col2 = st.columns(2)
        
        with col1:
            narration_speed = st.slider("Narration Speed", 0.5, 2.0, 1.0, 0.1)
            voice_language = st.selectbox("Voice Language", ["English", "Spanish", "French"])
        
        with col2:
            enable_sound_effects = st.checkbox("Sound Effects", value=True)
            auto_play_audio = st.checkbox("Auto-play Audio", value=False)
        
        # Visual settings
        st.subheader("üé® Visual Settings")
        
        col1, col2 = st.columns(2)
        
        with col1:
            text_size = st.selectbox("Text Size", ["Small", "Medium", "Large"])
            color_theme = st.selectbox("Color Theme", ["Bright", "Pastel", "High Contrast"])
        
        with col2:
            show_illustrations = st.checkbox("Show Illustrations", value=True)
            animated_text = st.checkbox("Animated Text", value=False)
        
        # Content settings
        st.subheader("üõ°Ô∏è Content & Safety")
        
        col1, col2 = st.columns(2)
        
        with col1:
            content_filter_level = st.selectbox(
                "Content Filter Level", 
                ["Strict", "Moderate", "Basic"]
            )
            
            educational_focus = st.multiselect(
                "Educational Focus",
                ["Reading", "Math", "Science", "Social Skills", "Creativity"],
                default=["Reading", "Social Skills"]
            )
        
        with col2:
            parental_controls = st.checkbox("Enable Parental Controls", value=True)
            save_reading_history = st.checkbox("Save Reading History", value=True)
        
        # Save settings
        if st.button("üíæ Save Settings"):
            settings = {
                'narration_speed': narration_speed,
                'voice_language': voice_language,
                'text_size': text_size,
                'color_theme': color_theme,
                'content_filter_level': content_filter_level,
                'educational_focus': educational_focus
            }
            
            st.session_state['user_settings'] = settings
            st.success("Settings saved successfully!")
        
        # Reset options
        st.subheader("üîÑ Reset Options")
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            if st.button("Reset Progress"):
                # Clear progress data
                for key in list(st.session_state.keys()):
                    if 'current_story' in key or 'progress' in key:
                        del st.session_state[key]
                st.success("Progress reset!")
        
        with col2:
            if st.button("Clear Cache"):
                # Clear temporary data
                st.cache_data.clear()
                st.success("Cache cleared!")
        
        with col3:
            if st.button("Factory Reset"):
                # Clear all session data
                st.session_state.clear()
                st.success("All data reset!")

if __name__ == "__main__":
    main()
````

### Environment Configuration

````python
OPENAI_API_KEY=your_openai_api_key_here
````

### Usage Instructions

````python
"""
Interactive Story Generator for Kids Setup and Usage Guide

1. Install dependencies:
   pip install -r requirements.txt

2. Install additional system dependencies:
   - For audio: pip install pygame
   - For TTS: pip install gtts
   - For image processing: pip install pillow

3. Set up environment:
   - Create .env file with OPENAI_API_KEY

4. Run the application:
   streamlit run interactive_story_generator.py

5. Features:
   - AI-generated personalized stories
   - Interactive story branching
   - Text-to-speech narration
   - AI-generated illustrations
   - Educational content integration
   - Progress tracking and analytics

6. Usage Flow:
   - Load sample user profiles
   - Select child profile and preferences
   - Create personalized story
   - Read interactively with choices
   - Track progress and achievements

7. Educational Benefits:
   - Vocabulary building
   - Reading comprehension
   - Decision-making skills
   - Creative thinking
   - Moral development

Safety Features:
- Content filtering for child safety
- Age-appropriate vocabulary
- Educational value integration
- Parental controls and oversight
- Progress monitoring

Technical Architecture:
- OpenAI GPT-4 for story generation
- DALL-E 3 for illustrations
- Google Text-to-Speech for narration
- Streamlit for user interface
- Safety filters for content validation
"""

def setup_story_generator():
    """Set up the interactive story generator."""
    print("Setting up Interactive Story Generator for Kids...")
    print("Features:")
    print("- Personalized AI story generation")
    print("- Interactive narrative branching")
    print("- Multi-modal content (text, images, audio)")
    print("- Educational content integration")
    print("- Child safety and content filtering")
    
    print("\nComponents:")
    print("- OpenAI GPT-4 for story creation")
    print("- DALL-E 3 for illustrations")
    print("- Text-to-speech for narration")
    print("- Progress tracking system")
    
    print("\nReady to run: streamlit run interactive_story_generator.py")

if __name__ == "__main__":
    setup_story_generator()
````

## Project Summary

The Interactive Story Generator for Kids represents an innovative fusion of AI technology and educational content creation that transforms how children engage with stories and develop literacy skills. By combining advanced natural language generation, visual storytelling, and interactive elements, it creates personalized learning experiences that adapt to each child's interests, reading level, and developmental needs.

### Key Value Propositions:
- **Personalized Learning**: Custom stories that adapt to individual interests, reading levels, and educational goals
- **Interactive Engagement**: Choice-driven narratives that make children active participants in storytelling
- **Multi-modal Experience**: Integration of text, images, and audio for diverse learning styles
- **Educational Integration**: Seamless incorporation of vocabulary building, moral lessons, and critical thinking skills
- **Safe Content Creation**: Advanced filtering and age-appropriate content generation with parental oversight

### Technical Highlights:
- Advanced prompt engineering for age-appropriate content generation using GPT-4
- Real-time story branching based on user choices and preferences
- AI-generated illustrations using DALL-E 3 with child-safety considerations
- Text-to-speech integration for accessibility and engagement
- Comprehensive progress tracking and educational analytics
- Robust content safety filtering and validation systems

This system demonstrates how AI can enhance childhood education by providing engaging, personalized, and safe learning experiences that foster creativity, literacy development, and critical thinking skills while maintaining the magic and wonder of storytelling that captivates young minds.